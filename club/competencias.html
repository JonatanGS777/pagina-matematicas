<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competencias Matem√°ticas Digitales - Prof. Yonatan Guerrero</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #4ecdc4;
            --warning: #ffe066;
            --danger: #ff6b6b;
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --dark: #2d3748;
            --light: #f7fafc;
            --white: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --glass: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --shadow-soft: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            --shadow-hover: 0 15px 35px rgba(31, 38, 135, 0.2);
            --gradient-main: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-competition: linear-gradient(135deg, #ff6b6b 0%, #ffa726 50%, #4ecdc4 100%);
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            --gradient-silver: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
            --gradient-bronze: linear-gradient(135deg, #cd7f32 0%, #daa520 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            padding-top: 80px;
        }

        /* Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: 
                linear-gradient(-45deg, rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8), rgba(240, 147, 251, 0.8), rgba(78, 205, 196, 0.8));
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Competition Particles */
        .competition-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .comp-particle {
            position: absolute;
            color: rgba(255, 255, 255, 0.6);
            font-family: 'Space Grotesk', monospace;
            font-weight: 600;
            pointer-events: none;
            animation: compFloat linear infinite;
        }

        .comp-particle.trophy {
            font-size: clamp(20px, 3vw, 28px);
            color: rgba(255, 215, 0, 0.7);
        }

        .comp-particle.medal {
            font-size: clamp(18px, 2.8vw, 24px);
            color: rgba(192, 192, 192, 0.6);
        }

        .comp-particle.formula {
            font-size: clamp(16px, 2.5vw, 22px);
            color: rgba(78, 205, 196, 0.5);
        }

        @keyframes compFloat {
            0% {
                transform: translateY(100vh) translateX(0) rotate(0deg) scale(0.8);
                opacity: 0;
            }
            5% {
                opacity: 1;
            }
            50% {
                transform: translateY(50vh) translateX(var(--drift, 0px)) rotate(180deg) scale(1);
            }
            95% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(calc(var(--drift, 0px) * 2)) rotate(360deg) scale(1.2);
                opacity: 0;
            }
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
            z-index: 1000;
            padding: 0;
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
        }

        .nav-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-competition);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-back {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            background: var(--gradient-main);
            color: var(--white);
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-back:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .nav-back i {
            margin-right: 0.5rem;
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 2rem;
        }

        .hero-content {
            backdrop-filter: blur(20px);
            background: var(--glass);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            padding: 4rem 3rem;
            box-shadow: var(--shadow-soft);
            max-width: 900px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .hero-content::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,215,0,0.1), transparent);
            transform: rotate(45deg);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }

        .hero h1 {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            color: var(--white);
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 2;
        }

        .hero-subtitle {
            font-size: clamp(1.2rem, 2.5vw, 1.8rem);
            color: rgba(255,255,255,0.9);
            margin-bottom: 2rem;
            font-weight: 400;
            position: relative;
            z-index: 2;
        }

        .competition-status {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 1rem 2rem;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            text-align: center;
            min-width: 150px;
        }

        .status-value {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 0.5rem;
        }

        .status-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Access Code Section */
        .access-section {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            z-index: 2;
        }

        .access-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            text-align: center;
        }

        .code-input-group {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
            flex-wrap: wrap;
        }

        .code-input {
            width: 60px;
            height: 60px;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            border: 2px solid var(--primary);
            border-radius: 10px;
            background: var(--light);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .code-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.3);
            transform: scale(1.05);
        }

        .code-input.correct {
            background: var(--success);
            color: var(--white);
            border-color: var(--success);
        }

        .code-input.incorrect {
            background: var(--danger);
            color: var(--white);
            border-color: var(--danger);
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .access-btn {
            display: block;
            margin: 2rem auto 0;
            padding: 1rem 3rem;
            background: var(--gradient-main);
            color: var(--white);
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .access-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .access-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Main Content */
        .main-content {
            background: var(--light);
            border-radius: 50px 50px 0 0;
            margin-top: 2rem;
            position: relative;
            z-index: 10;
            display: none;
        }

        .main-content.active {
            display: block;
        }

        .section {
            padding: 5rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        .section-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: clamp(2.5rem, 4vw, 3.5rem);
            font-weight: 700;
            text-align: center;
            margin-bottom: 3rem;
            background: var(--gradient-competition);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        /* Competition Dashboard */
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-main {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: var(--shadow-soft);
        }

        .dashboard-sidebar {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Timer Card */
        .timer-card {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: var(--shadow-soft);
            text-align: center;
            border: 2px solid var(--danger);
        }

        .timer-display {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--danger);
            margin-bottom: 0.5rem;
        }

        .timer-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Score Card */
        .score-card {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: var(--shadow-soft);
            text-align: center;
            border: 2px solid var(--success);
        }

        .score-display {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .score-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Competition Areas */
        .areas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .area-card {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: var(--shadow-soft);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .area-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-main);
        }

        .area-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            border-color: var(--primary);
        }

        /* Disabled state for areas */
        .area-card {
            opacity: 0.85;
            position: relative;
        }

        .area-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            pointer-events: none;
        }

        .area-card.algebra::before {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa726 100%);
        }

        .area-card.geometry::before {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
        }

        .area-card.calculus::before {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .area-card.trigonometry::before {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .area-card.mental-calc::before {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
        }

        .area-card.puzzles::before {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
        }

        .area-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: var(--gradient-main);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .area-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .area-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .difficulty-levels {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .difficulty-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .difficulty-badge.easy {
            background: rgba(78, 205, 196, 0.2);
            color: var(--success);
        }

        .difficulty-badge.medium {
            background: rgba(255, 230, 102, 0.2);
            color: #daa520;
        }

        .difficulty-badge.hard {
            background: rgba(255, 107, 107, 0.2);
            color: var(--danger);
        }

        .area-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Leaderboard */
        .leaderboard {
            background: var(--white);
            border-radius: 25px;
            padding: 2rem;
            box-shadow: var(--shadow-soft);
            margin-bottom: 3rem;
        }

        .leaderboard-title {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .leaderboard-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--light);
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .leaderboard-item.first {
            background: var(--gradient-gold);
            color: var(--white);
        }

        .leaderboard-item.second {
            background: var(--gradient-silver);
            color: var(--dark);
        }

        .leaderboard-item.third {
            background: var(--gradient-bronze);
            color: var(--white);
        }

        .rank-number {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            margin-right: 1rem;
            min-width: 40px;
        }

        .participant-info {
            flex: 1;
        }

        .participant-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .participant-school {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .participant-score {
            font-family: 'Space Grotesk', sans-serif;
            font-size: 1.25rem;
            font-weight: 700;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .competition-status {
                flex-direction: column;
                align-items: center;
            }

            .code-input-group {
                justify-content: center;
            }

            .code-input {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
            }

            .areas-grid {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 3rem 1rem;
            }
        }

        /* Animations */
        .fade-in {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .bounce {
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Success Message */
        .success-message {
            background: linear-gradient(135deg, var(--success) 0%, #44a08d 100%);
            color: var(--white);
            padding: 1rem 2rem;
            border-radius: 25px;
            text-align: center;
            margin: 1rem 0;
            font-weight: 500;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Error Message */
        .error-message {
            background: linear-gradient(135deg, var(--danger) 0%, #f5576c 100%);
            color: var(--white);
            padding: 1rem 2rem;
            border-radius: 25px;
            text-align: center;
            margin: 1rem 0;
            font-weight: 500;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: slideDown 0.5s ease-out;
        }

        /* Floating Points Animation */
        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 1;
                transform: translate(-50%, -150%) scale(1.2);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -250%) scale(0.8);
            }
        }

        /* Enhanced Pulse Animation */
        .pulse {
            animation: enhancedPulse 0.6s ease-in-out;
        }

        @keyframes enhancedPulse {
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 0 rgba(102, 126, 234, 0.4);
            }
            50% { 
                transform: scale(1.1); 
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
            }
        }

        /* Notification animations */
        @keyframes popIn {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        @keyframes popOut {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
        }

        /* Waiting timer animation */
        @keyframes waitingPulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.05);
            }
        }

        /* Success glow animation */
        @keyframes successGlow {
            0%, 100% { 
                box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            }
            50% { 
                box-shadow: 0 20px 40px rgba(0,0,0,0.3), 0 0 30px rgba(78, 205, 196, 0.8);
            }
        }
        /* Bot√≥n hamburguesa - solo visible en m√≥vil */
.mobile-menu-btn {
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 40px;
    height: 40px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1001;
}

.mobile-menu-btn:hover {
    background: rgba(102, 126, 234, 0.1);
}

.hamburger-line {
    display: block;
    width: 24px;
    height: 3px;
    background: var(--text-primary);
    margin: 3px 0;
    transition: all 0.3s ease;
    border-radius: 2px;
}

/* Animaci√≥n del bot√≥n hamburguesa cuando est√° activo */
.mobile-menu-btn.active .hamburger-line:nth-child(1) {
    transform: rotate(45deg) translate(6px, 6px);
}

.mobile-menu-btn.active .hamburger-line:nth-child(2) {
    opacity: 0;
}

.mobile-menu-btn.active .hamburger-line:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
}

/* Overlay para cerrar men√∫ m√≥vil */
.mobile-menu-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
}

/* Estilos base para nav-controls */
.nav-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

/* Actualizar estilos de botones para responsividad */
.nav-back {
    display: flex;
    align-items: center;
    padding: 0.75rem 1.5rem;
    text-decoration: none;
    border-radius: 25px;
    font-weight: 500;
    transition: all 0.3s ease;
    border: none;
    cursor: pointer;
    font-family: inherit;
    font-size: inherit;
    white-space: nowrap;
}

.nav-back:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
}

.nav-back i {
    margin-right: 0.5rem;
    flex-shrink: 0;
}

/* Colores espec√≠ficos para cada bot√≥n */
.leaderboard-btn {
    background: var(--success);
    color: var(--white);
}

.timer-btn {
    background: var(--primary);
    color: var(--white);
}

.admin-btn {
    background: var(--text-secondary);
    color: var(--white);
    font-size: 0.8rem;
    opacity: 0.7;
}

.home-btn {
    background: var(--gradient-main);
    color: var(--white);
}

/* Responsive breakpoints - COMPETENCIAS */
@media (max-width: 1200px) {
    /* En pantallas medianas, ocultar texto de algunos botones */
    .admin-btn .btn-text,
    .timer-btn .btn-text {
        display: none;
    }
    
    .nav-back {
        padding: 0.75rem 1rem;
    }
    
    .nav-back i {
        margin-right: 0;
    }
}

@media (max-width: 1024px) {
    /* Ocultar m√°s textos en tablet */
    .leaderboard-btn .btn-text {
        display: none;
    }
    
    .nav-controls {
        gap: 0.75rem;
    }
    
    .navbar {
        padding: 1rem 1.5rem;
    }
    
    .logo {
        font-size: 1.3rem;
    }
}

@media (max-width: 900px) {
    /* Punto de quiebre para mostrar men√∫ m√≥vil */
    .mobile-menu-btn {
        display: flex;
    }
    
    .nav-controls {
        position: fixed;
        top: 0;
        right: -100%;
        width: 320px;
        height: 100vh;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        border-left: 2px solid rgba(102, 126, 234, 0.2);
        flex-direction: column;
        justify-content: flex-start;
        align-items: stretch;
        padding: 100px 2rem 2rem 2rem;
        margin: 0;
        transition: right 0.3s ease;
        z-index: 1000;
        box-shadow: -10px 0 30px rgba(0, 0, 0, 0.1);
        gap: 1.5rem;
    }
    
    .nav-controls.active {
        right: 0;
    }
    
    .nav-controls.active ~ .mobile-menu-overlay {
        display: block;
    }
    
    /* Estilos de botones en men√∫ m√≥vil */
    .nav-back {
        width: 100%;
        justify-content: flex-start;
        padding: 1.2rem 1.5rem;
        border-radius: 15px;
        font-size: 1rem;
        position: relative;
        overflow: hidden;
        margin-bottom: 0.5rem;
    }
    
    .nav-back .btn-text {
        display: inline !important;
        margin-left: 0.75rem;
    }
    
    .nav-back::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.3s ease;
        z-index: -1;
    }
    
    .nav-back:hover::before {
        left: 100%;
    }
    
    .nav-back:hover {
        transform: translateX(5px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    
    /* Separadores visuales en m√≥vil */
    .leaderboard-btn {
        border: 2px solid rgba(78, 205, 196, 0.3);
    }
    
    .timer-btn {
        border: 2px solid rgba(102, 126, 234, 0.3);
    }
    
    .admin-btn {
        border: 2px solid rgba(113, 128, 150, 0.3);
        margin-top: 1rem;
    }
    
    .admin-btn::before {
        content: '';
        position: absolute;
        top: -10px;
        left: 20%;
        width: 60%;
        height: 1px;
        background: rgba(113, 128, 150, 0.3);
    }
    
    .home-btn {
        border: 2px solid rgba(102, 126, 234, 0.3);
        margin-top: 1rem;
        background: var(--text-secondary);
    }
    
    .navbar {
        padding: 1rem;
    }
    
    .logo {
        font-size: 1.2rem;
    }
}

@media (max-width: 768px) {
    /* Ajustes para m√≥viles est√°ndar */
    .nav-controls {
        width: 100%;
    }
    
    .hero-content {
        padding: 3rem 2rem;
    }
    
    .competition-status {
        flex-direction: column;
        align-items: center;
    }
    
    .code-input-group {
        justify-content: center;
    }
    
    .code-input {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
    }
    
    .dashboard {
        grid-template-columns: 1fr;
    }
    
    .areas-grid {
        grid-template-columns: 1fr;
    }
    
    .section {
        padding: 3rem 1rem;
    }
}

@media (max-width: 480px) {
    /* M√≥viles peque√±os */
    .navbar {
        padding: 0.75rem;
    }
    
    .logo {
        font-size: 1rem;
    }
    
    .logo i {
        font-size: 0.9rem;
    }
    
    .mobile-menu-btn {
        width: 35px;
        height: 35px;
    }
    
    .hamburger-line {
        width: 20px;
        height: 2px;
    }
    
    .nav-controls {
        width: 100%;
        padding: 80px 1rem 2rem 1rem;
    }
    
    .nav-back {
        padding: 1rem 1.2rem;
        font-size: 0.95rem;
    }
    
    /* Hero section ajustments */
    .hero-content {
        padding: 2rem 1.5rem;
    }
    
    .hero h1 {
        font-size: 2rem;
    }
    
    .hero-subtitle {
        font-size: 1.1rem;
    }
    
    .status-item {
        min-width: 120px;
        padding: 0.75rem 1.5rem;
    }
    
    .code-input {
        width: 45px;
        height: 45px;
        font-size: 1.1rem;
    }
    
    .access-btn {
        padding: 0.9rem 2rem;
        font-size: 1rem;
    }
}

/* Animaciones espec√≠ficas para competencias */
@media (prefers-reduced-motion: no-preference) {
    .nav-controls {
        transition: right 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    
    .nav-back {
        transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
    
    .hamburger-line {
        transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    }
}

/* Para usuarios que prefieren menos animaci√≥n */
@media (prefers-reduced-motion: reduce) {
    .nav-controls,
    .nav-back,
    .hamburger-line,
    .mobile-menu-btn {
        transition: none;
    }
}

/* Focus visible para accesibilidad */
.mobile-menu-btn:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

.nav-back:focus-visible {
    outline: 2px solid var(--primary);
    outline-offset: 2px;
}

/* Estados especiales para botones de competencia */
.timer-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none !important;
}

.timer-btn.started {
    background: var(--success) !important;
    border-color: var(--success) !important;
}

.timer-btn.started i {
    animation: none;
}

/* Indicadores de estado */
@keyframes pulse-success {
    0%, 100% { 
        box-shadow: 0 0 0 0 rgba(78, 205, 196, 0.7); 
    }
    50% { 
        box-shadow: 0 0 0 10px rgba(78, 205, 196, 0); 
    }
}

.timer-btn.started {
    animation: pulse-success 2s infinite;
}

/* Notificaci√≥n m√≥vil para estado del timer */
@media (max-width: 900px) {
    .timer-status-indicator {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background: var(--success);
        display: none;
    }
    
    .timer-btn.started .timer-status-indicator {
        display: block;
        animation: pulse-success 2s infinite;
    }
}

/* Mejoras adicionales para usabilidad m√≥vil */
@media (max-width: 900px) {
    .nav-back {
        touch-action: manipulation; /* Previene delay en touch */
    }
    
    .mobile-menu-btn {
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
    }
    
    /* √Årea de toque m√°s grande para botones peque√±os */
    .admin-btn {
        min-height: 48px;
    }
    
    /* Separaci√≥n visual entre secciones de botones */
    .nav-controls::before {
        content: 'CONTROLES DE COMPETENCIA';
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--text-secondary);
        text-align: center;
        letter-spacing: 1px;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(102, 126, 234, 0.2);
    }
}
</style>
</head>
<body>
    <header class="header">
    <nav class="navbar">
        <a href="#" class="logo">
            <i class="fas fa-trophy"></i>
            Competencias Matem√°ticas
        </a>
        
        <!-- Bot√≥n hamburguesa para m√≥vil -->
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Abrir men√∫">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
        </button>
        
        <div class="nav-controls" id="navControls">
            <a href="leaderboard.html" class="nav-back leaderboard-btn" target="_blank">
                <i class="fas fa-trophy"></i>
                <span class="btn-text">Ver Tabla de Posiciones</span>
            </a>
            
            <button class="nav-back timer-btn" onclick="startCompetitionTimer()">
                <i class="fas fa-play"></i>
                <span class="btn-text">Iniciar Timer</span>
            </button>
            
            <button class="nav-back admin-btn" onclick="resetCompetition()">
                <i class="fas fa-cog"></i>
                <span class="btn-text">Admin</span>
            </button>
            
            <a href="../index.html" class="nav-back home-btn">
                <i class="fas fa-arrow-left"></i>
                <span class="btn-text">Volver al Inicio</span>
            </a>
        </div>
        
        <!-- Overlay para cerrar men√∫ m√≥vil -->
        <div class="mobile-menu-overlay" onclick="closeMobileMenu()"></div>
    </nav>
</header>

    <!-- Animated Background -->
    <div class="animated-bg"></div>
    
    <!-- Competition Particles -->
    <div class="competition-particles" id="compParticles"></div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>üèÜ Competencias Matem√°ticas Digitales</h1>
            <p class="hero-subtitle">Demuestra tus habilidades matem√°ticas en tiempo real</p>
            
            <div class="competition-status">
                <div class="status-item">
                    <div class="status-value" id="activeParticipants">0</div>
                    <div class="status-label">Participantes</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="totalProblems">180</div>
                    <div class="status-label">Problemas</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="competitionStatus">En Espera</div>
                    <div class="status-label">Estado</div>
                </div>
            </div>

            <div class="access-section">
                <h3 class="access-title">
                    <i class="fas fa-key"></i>
                    C√≥digo de Acceso a la Competencia
                </h3>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 1rem;">
                    Ingresa el c√≥digo proporcionado por el profesor para acceder a la competencia
                </p>
                
                <div class="code-input-group">
                    <input type="text" class="code-input" maxlength="1" id="code1">
                    <input type="text" class="code-input" maxlength="1" id="code2">
                    <input type="text" class="code-input" maxlength="1" id="code3">
                    <input type="text" class="code-input" maxlength="1" id="code4">
                    <input type="text" class="code-input" maxlength="1" id="code5">
                    <input type="text" class="code-input" maxlength="1" id="code6">
                </div>

                <div class="success-message" id="successMessage">
                    <i class="fas fa-check-circle"></i>
                    ¬°C√≥digo correcto! Acceso concedido a la competencia
                </div>

                <div class="error-message" id="errorMessage">
                    <i class="fas fa-times-circle"></i>
                    C√≥digo incorrecto. Verifica e intenta nuevamente
                </div>

                <button class="access-btn" id="accessBtn" onclick="verifyAccessCode()">
                    <i class="fas fa-unlock"></i>
                    Acceder a la Competencia
                </button>
            </div>
        </div>
    </section>

    <!-- Main Competition Content -->
    <main class="main-content" id="mainContent">
        <!-- Competition Dashboard -->
        <section class="section">
            <h2 class="section-title">Panel de Competencia</h2>
            
            <div class="dashboard">
                <div class="dashboard-main">
                    <h3 style="font-family: 'Space Grotesk', sans-serif; font-size: 1.5rem; margin-bottom: 2rem; color: var(--text-primary);">
                        <i class="fas fa-chart-line"></i>
                        Tu Progreso en Tiempo Real
                    </h3>
                    
                    <div class="areas-grid">
                        <div class="area-card algebra" onclick="window.location.href='modulos/algebra.html'">
                            <div class="area-icon">
                                <i class="fas fa-square-root-alt"></i>
                            </div>
                            <h4 class="area-title">√Ålgebra</h4>
                            <p class="area-description">Ecuaciones, sistemas lineales, polinomios y funciones</p>
                            <div class="difficulty-levels">
                                <span class="difficulty-badge easy">F√°cil (5 pts)</span>
                                <span class="difficulty-badge medium">Medio (10 pts)</span>
                                <span class="difficulty-badge hard">Dif√≠cil (15 pts)</span>
                            </div>
                            <div class="area-stats">
                                <span>30 problemas</span>
                                <span style="color: var(--warning); font-weight: 600;">üöß Pr√≥ximamente</span>
                            </div>
                        </div>

                        <div class="area-card geometry" onclick="window.location.href='modulos/geometry.html'">

                            <div class="area-icon">
                                <i class="fas fa-shapes"></i>
                            </div>
                            <h4 class="area-title">Geometr√≠a</h4>
                            <p class="area-description">Figuras planas, s√≥lidos, per√≠metros y √°reas</p>
                            <div class="difficulty-levels">
                                <span class="difficulty-badge easy">F√°cil (5 pts)</span>
                                <span class="difficulty-badge medium">Medio (10 pts)</span>
                                <span class="difficulty-badge hard">Dif√≠cil (15 pts)</span>
                            </div>
                            <div class="area-stats">
                                <span>30 problemas</span>
                                <span style="color: var(--warning); font-weight: 600;">üöß Pr√≥ximamente</span>
                            </div>
                        </div>

                        <div class="area-card calculus" onclick="window.location.href='modulos/calculus.html'">
                            <div class="area-icon">
                                <i class="fas fa-infinity"></i>
                            </div>
                            <h4 class="area-title">C√°lculo</h4>
                            <p class="area-description">L√≠mites, derivadas e integrales</p>
                            <div class="difficulty-levels">
                                <span class="difficulty-badge easy">F√°cil (5 pts)</span>
                                <span class="difficulty-badge medium">Medio (10 pts)</span>
                                <span class="difficulty-badge hard">Dif√≠cil (15 pts)</span>
                            </div>
                            <div class="area-stats">
                                <span>30 problemas</span>
                                <span style="color: var(--warning); font-weight: 600;">üöß Pr√≥ximamente</span>
                            </div>
                        </div>

                        <div class="area-card trigonometry" onclick="window.location.href='modulos/trigonometry.html'">
                            <div class="area-icon">
                                <i class="fas fa-wave-square"></i>
                            </div>
                            <h4 class="area-title">Trigonometr√≠a</h4>
                            <p class="area-description">Funciones trigonom√©tricas, identidades y aplicaciones</p>
                            <div class="difficulty-levels">
                                <span class="difficulty-badge easy">F√°cil (5 pts)</span>
                                <span class="difficulty-badge medium">Medio (10 pts)</span>
                                <span class="difficulty-badge hard">Dif√≠cil (15 pts)</span>
                            </div>
                            <div class="area-stats">
                                <span>30 problemas</span>
                                <span style="color: var(--warning); font-weight: 600;">üöß Pr√≥ximamente</span>
                            </div>
                        </div>

                            <div class="area-card statistics" onclick="window.location.href='modulos/statistics.html'">
                            <div class="area-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h4 class="area-title">Estad√≠sticas</h4>
                            <p class="area-description">Datos, representaciones gr√°ficas y an√°lisis estad√≠stico b√°sico</p>
                            <div class="difficulty-levels">
                                <span class="difficulty-badge easy">F√°cil (5 pts)</span>
                                <span class="difficulty-badge medium">Medio (10 pts)</span>
                                <span class="difficulty-badge hard">Dif√≠cil (15 pts)</span>
                            </div>
                            <div class="area-stats">
                                <span>30 problemas</span>
                                <span style="color: var(--warning); font-weight: 600;">üöß Pr√≥ximamente</span>
                            </div>
                        </div>


                        <div class="area-card puzzles" onclick="window.location.href='modulos/puzzles.html'">
                            <div class="area-icon">
                                <i class="fas fa-puzzle-piece"></i>
                            </div>
                            <h4 class="area-title">Acertijos</h4>
                            <p class="area-description">L√≥gica matem√°tica, patrones y desaf√≠os mentales</p>
                            <div class="difficulty-levels">
                                <span class="difficulty-badge easy">F√°cil (5 pts)</span>
                                <span class="difficulty-badge medium">Medio (10 pts)</span>
                                <span class="difficulty-badge hard">Dif√≠cil (15 pts)</span>
                            </div>
                            <div class="area-stats">
                                <span>30 problemas</span>
                                <span style="color: var(--warning); font-weight: 600;">üöß Pr√≥ximamente</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-sidebar">
                    <div class="timer-card">
                        <div class="timer-display" id="timer">02:00:00</div>
                        <div class="timer-label">Tiempo Restante</div>
                    </div>

                    <div class="score-card">
                        <div class="score-display" id="currentScore">0</div>
                        <div class="score-label">Puntos Totales</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Leaderboard -->
        <section class="section">
            <div class="leaderboard fade-in">
                <h3 class="leaderboard-title">
                    <i class="fas fa-crown"></i>
                    Tabla de Posiciones en Vivo
                    <span id="lastUpdateTime" style="font-size: 0.7rem; opacity: 0.7; margin-left: 1rem;"></span>
                </h3>
                
                <div class="leaderboard-list" id="liveLeaderboardList">
                    <!-- Real participants will be populated here -->
                </div>
            </div>
        </section>
    </main>

    <script>
        // ============================================================
        // Competition Management System ‚Äî Supabase Real-Time
        // ============================================================
        class CompetitionManager {
            constructor() {
                this.SUPABASE_URL = 'https://mywwtkpcswisdwrfqzch.supabase.co';
                this.SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im15d3d0a3Bjc3dpc2R3cmZxemNoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyOTQzOTgsImV4cCI6MjA4Njg3MDM5OH0.XEzvjC7PmDG6uEhiYzo8HgK564WXKUi94LNHaS6jkQs';
                this.supabase       = null;
                this.currentScore   = 0;
                this.timeRemaining  = 7200;
                this.timerInterval  = null;
                this.currentParticipant  = null;
                this.currentCompetition  = null;
                this.realtimeChannel     = null;
                this.visitorId = this.getOrCreateVisitorId();
                this.init();
            }
                this.currentScore = 0;
                this.timeRemaining = 7200; // 2 horas en segundos
                this.timerInterval = null;
                this.participantCount = 0;
                this.currentParticipant = null;
                this.areas = ['algebra', 'geometry', 'calculus', 'trigonometry', 'mental-calc', 'puzzles'];
                
                this.init();
            }

            getOrCreateVisitorId() {
                let id = localStorage.getItem('visitor_id');
                if (!id) {
                    id = 'visitor_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('visitor_id', id);
                }
                return id;
            }

            async init() {
                this.supabase = window.supabase.createClient(this.SUPABASE_URL, this.SUPABASE_ANON_KEY);
                this.setupCodeInputs();
                this.createCompetitionParticles();
                this.setupAnimations();
                await this.loadCompetitionState();
                this.setupRealtime();
            }

            async loadCompetitionState() {
                const { data, error } = await this.supabase.rpc('get_active_competition');
                if (error || !data || data.length === 0) return;

                this.currentCompetition = data[0];
                document.getElementById('activeParticipants').textContent = this.currentCompetition.participant_count || 0;
                document.getElementById('competitionStatus').textContent =
                    this.currentCompetition.status === 'active'  ? 'Activa'    :
                    this.currentCompetition.status === 'waiting' ? 'En Espera' : 'Finalizada';

                // Restaurar participante guardado si corresponde a esta competencia
                const saved = localStorage.getItem('currentParticipant');
                if (saved) {
                    const p = JSON.parse(saved);
                    if (p.competition_id === this.currentCompetition.id) {
                        this.currentParticipant = p;
                        this.currentScore = p.total_score || 0;
                        document.getElementById('currentScore').textContent = this.currentScore;
                        this.updateTimerButtonState();
                        // Si el timer ya fue iniciado, saltar directo al panel
                        if (this.currentCompetition.timer_started && this.currentCompetition.start_time) {
                            const elapsed = Math.floor((Date.now() - new Date(this.currentCompetition.start_time).getTime()) / 1000);
                            this.timeRemaining = Math.max(0, this.currentCompetition.duration - elapsed);
                            document.querySelector('.hero').style.display = 'none';
                            document.getElementById('mainContent').classList.add('active');
                            this.startActiveTimer();
                        }
                    } else {
                        localStorage.removeItem('currentParticipant');
                    }
                }

                await this.updateLiveLeaderboard();
            }

            setupRealtime() {
                if (!this.currentCompetition) return;

                this.realtimeChannel = this.supabase
                    .channel('competition_realtime')
                    .on('postgres_changes', {
                        event: '*', schema: 'public', table: 'competitions',
                        filter: `id=eq.${this.currentCompetition.id}`
                    }, (payload) => this.handleCompetitionUpdate(payload))
                    .on('postgres_changes', {
                        event: '*', schema: 'public', table: 'competition_participants',
                        filter: `competition_id=eq.${this.currentCompetition.id}`
                    }, (payload) => this.handleParticipantUpdate(payload))
                    .subscribe();
            }

            handleCompetitionUpdate(payload) {
                const comp = payload.new;
                this.currentCompetition = { ...this.currentCompetition, ...comp };

                // El profesor acaba de iniciar el timer
                if (comp.timer_started && !this.timerInterval) {
                    document.getElementById('competitionStatus').textContent = 'Activa';
                    const elapsed = Math.floor((Date.now() - new Date(comp.start_time).getTime()) / 1000);
                    this.timeRemaining = Math.max(0, comp.duration - elapsed);
                    if (this.timerInterval) clearInterval(this.timerInterval);
                    this.startActiveTimer();
                    this.showStartNotification();
                    this.updateTimerButtonState();
                }

                // La competencia fue reiniciada
                if (comp.status === 'ended') {
                    localStorage.removeItem('currentParticipant');
                    location.reload();
                }
            }

            handleParticipantUpdate(payload) {
                // Actualizar leaderboard y contador en tiempo real
                this.updateLiveLeaderboard();
                this.updateParticipantCount();

                // Si es actualizaci√≥n del propio participante, refrescar score
                if (this.currentParticipant && payload.new && payload.new.id === this.currentParticipant.id) {
                    this.currentParticipant = payload.new;
                    this.currentScore = payload.new.total_score;
                    document.getElementById('currentScore').textContent = this.currentScore;
                    localStorage.setItem('currentParticipant', JSON.stringify(this.currentParticipant));
                }
            }

            async updateParticipantCount() {
                const { count } = await this.supabase
                    .from('competition_participants')
                    .select('*', { count: 'exact', head: true })
                    .eq('competition_id', this.currentCompetition.id)
                    .eq('is_active', true);
                document.getElementById('activeParticipants').textContent = count || 0;
            }

            updateTimerButtonState() {
                const startButton = document.querySelector('[onclick="startCompetitionTimer()"]');
                if (startButton && this.currentCompetition && this.currentCompetition.timer_started) {
                    startButton.innerHTML = '<i class="fas fa-check"></i> Timer Iniciado';
                    startButton.style.background = 'var(--success)';
                    startButton.disabled = true;
                }
            }

            // Stub vac√≠o para compatibilidad con c√≥digo antiguo que quede
            updateCompetitionData() {}

            async addScore(area, points, difficulty) {
                if (!this.currentParticipant) return;

                const { data, error } = await this.supabase.rpc('update_competition_score', {
                    p_participant_id: this.currentParticipant.id,
                    p_area:           area,
                    p_points:         points,
                    p_difficulty:     difficulty
                });

                if (!error && data && data.success) {
                    this.currentScore += points;
                    document.getElementById('currentScore').textContent = this.currentScore;
                    this.currentParticipant.total_score = this.currentScore;
                    localStorage.setItem('currentParticipant', JSON.stringify(this.currentParticipant));
                    this.showScoreAnimation(points, difficulty);
                }
            }

            showScoreAnimation(points, difficulty) {
                const scoreElement = document.getElementById('currentScore');
                scoreElement.classList.add('pulse');
                
                // Create floating points animation
                const floatingPoints = document.createElement('div');
                floatingPoints.textContent = `+${points}`;
                floatingPoints.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 2rem;
                    font-weight: 700;
                    color: ${difficulty === 'hard' ? '#ff6b6b' : difficulty === 'medium' ? '#ffe066' : '#4ecdc4'};
                    pointer-events: none;
                    z-index: 9999;
                    animation: floatUp 2s ease-out forwards;
                `;

                document.body.appendChild(floatingPoints);

                setTimeout(() => {
                    scoreElement.classList.remove('pulse');
                    if (floatingPoints.parentNode) {
                        floatingPoints.parentNode.removeChild(floatingPoints);
                    }
                }, 2000);
            }

            // Ya no se usa ‚Äî actividad queda registrada en Supabase via update_competition_score
            addRecentActivity() {}

            setupCodeInputs() {
                const inputs = document.querySelectorAll('.code-input');
                
                inputs.forEach((input, index) => {
                    input.addEventListener('input', (e) => {
                        const value = e.target.value.toUpperCase();
                        e.target.value = value;
                        
                        // Auto-focus next input
                        if (value && index < inputs.length - 1) {
                            inputs[index + 1].focus();
                        }
                        
                        // Reset input styles
                        e.target.classList.remove('correct', 'incorrect');
                    });

                    input.addEventListener('keydown', (e) => {
                        // Handle backspace
                        if (e.key === 'Backspace' && !e.target.value && index > 0) {
                            inputs[index - 1].focus();
                        }
                    });

                    input.addEventListener('paste', (e) => {
                        e.preventDefault();
                        const paste = e.clipboardData.getData('text').toUpperCase();
                        
                        for (let i = 0; i < Math.min(paste.length, inputs.length - index); i++) {
                            inputs[index + i].value = paste[i];
                        }
                        
                        // Focus last filled input
                        const lastIndex = Math.min(index + paste.length - 1, inputs.length - 1);
                        inputs[lastIndex].focus();
                    });
                });
            }

            async verifyCode() {
                const inputs     = document.querySelectorAll('.code-input');
                const enteredCode = Array.from(inputs).map(i => i.value).join('').toUpperCase();
                const successMsg = document.getElementById('successMessage');
                const errorMsg   = document.getElementById('errorMessage');

                successMsg.classList.remove('show');
                errorMsg.classList.remove('show');

                if (enteredCode.length < 4) {
                    errorMsg.classList.add('show');
                    return;
                }

                const name = prompt('Ingresa tu nombre completo:');
                if (!name) return;
                const school = prompt('Ingresa el nombre de tu escuela:');
                if (!school) return;

                const { data, error } = await this.supabase.rpc('join_competition', {
                    p_code:       enteredCode,
                    p_visitor_id: this.visitorId,
                    p_name:       name.trim(),
                    p_school:     school.trim()
                });

                if (error || !data || !data.success) {
                    inputs.forEach(i => i.classList.add('incorrect'));
                    errorMsg.classList.add('show');
                    setTimeout(() => {
                        inputs.forEach(i => { i.classList.remove('incorrect'); i.value = ''; });
                        inputs[0].focus();
                    }, 1500);
                    return;
                }

                // C√≥digo correcto
                inputs.forEach(i => { i.classList.add('correct'); i.disabled = true; });
                successMsg.classList.add('show');

                this.currentParticipant = data.participant;
                this.currentCompetition = { ...this.currentCompetition, ...data.competition };
                this.currentScore = data.participant.total_score || 0;
                document.getElementById('currentScore').textContent = this.currentScore;
                localStorage.setItem('currentParticipant', JSON.stringify(this.currentParticipant));

                // Activar realtime si no estaba
                if (!this.realtimeChannel) this.setupRealtime();

                setTimeout(() => { this.startCompetition(); }, 2000);
            }

            startCompetition() {
                const mainContent = document.getElementById('mainContent');
                const hero = document.querySelector('.hero');
                
                // Update status to preparing
                document.getElementById('competitionStatus').textContent = 'Preparando';
                
                // Show welcome message with participant info
                alert(`¬°Bienvenido ${this.currentParticipant.name}!\n\n‚è≥ Esperando que el profesor inicie la competencia...\n\nPuedes ver la tabla de posiciones mientras esperas.`);
                
                // Show main content with smooth transition
                setTimeout(() => {
                    hero.style.display = 'none';
                    mainContent.classList.add('active');
                    
                    // Start timer in standby mode (not counting down yet)
                    this.startTimerStandby();
                }, 500);
            }

            startTimerStandby() {
                this.updateTimerDisplay();

                // Si el timer ya fue iniciado (ej: participante vuelve a la p√°gina)
                if (this.currentCompetition && this.currentCompetition.timer_started && this.currentCompetition.start_time) {
                    document.getElementById('competitionStatus').textContent = 'Activa';
                    const elapsed = Math.floor((Date.now() - new Date(this.currentCompetition.start_time).getTime()) / 1000);
                    this.timeRemaining = Math.max(0, this.currentCompetition.duration - elapsed);
                    this.startActiveTimer();
                    return;
                }

                // Mostrar timer en espera; Supabase Realtime notificar√° cuando el profesor inicie
                this.timerInterval = setInterval(() => { this.updateTimerDisplay(); }, 1000);
            }

            startActiveTimer() {
                if (this.timerInterval) clearInterval(this.timerInterval);
                this.timerInterval = setInterval(() => {
                    if (this.currentCompetition && this.currentCompetition.start_time) {
                        const elapsed = Math.floor((Date.now() - new Date(this.currentCompetition.start_time).getTime()) / 1000);
                        this.timeRemaining = Math.max(0, this.currentCompetition.duration - elapsed);
                    }
                    this.updateTimerDisplay();
                    if (this.timeRemaining <= 0) this.endCompetition();
                }, 1000);
            }

            showStartNotification() {
                // Create a prominent notification that competition has started
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: linear-gradient(135deg, var(--success) 0%, #44a08d 100%);
                    color: white;
                    padding: 2rem 3rem;
                    border-radius: 25px;
                    text-align: center;
                    font-size: 1.5rem;
                    font-weight: 700;
                    z-index: 9999;
                    box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                    animation: popIn 0.5s ease-out;
                    border: 2px solid rgba(255,255,255,0.3);
                `;
                
                notification.innerHTML = `
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üöÄ</div>
                    <div>¬°COMPETENCIA INICIADA!</div>
                    <div style="font-size: 1rem; margin-top: 0.5rem; opacity: 0.9;">El cron√≥metro est√° corriendo</div>
                    <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.7;">¬°Buena suerte!</div>
                `;
                
                document.body.appendChild(notification);
                
                // Add sound effect simulation with animation
                notification.style.animation = 'popIn 0.5s ease-out, successGlow 1s ease-in-out 0.5s';
                
                // Remove after 4 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.style.animation = 'popOut 0.3s ease-in forwards';
                        setTimeout(() => {
                            if (notification.parentNode) {
                                notification.parentNode.removeChild(notification);
                            }
                        }, 300);
                    }
                }, 4000);
            }

            updateTimerDisplay() {
                const hours   = Math.floor(this.timeRemaining / 3600);
                const minutes = Math.floor((this.timeRemaining % 3600) / 60);
                const seconds = this.timeRemaining % 60;
                const display = `${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
                const el = document.getElementById('timer');
                if (!el) return;

                const started = this.currentCompetition && this.currentCompetition.timer_started;
                if (!started) {
                    el.textContent = '‚è≥ ' + display;
                    el.style.color = 'var(--warning)';
                    el.style.animation = 'waitingPulse 2s infinite';
                } else {
                    el.textContent = display;
                    el.style.animation = 'none';
                    if (this.timeRemaining <= 300)      { el.style.color = 'var(--danger)'; el.classList.add('pulse'); }
                    else if (this.timeRemaining <= 600) { el.style.color = 'var(--warning)'; }
                    else                                { el.style.color = 'var(--success)'; }
                }
            }

            endCompetition() {
                clearInterval(this.timerInterval);
                alert('¬°Tiempo terminado! La competencia ha finalizado.');
                // Aqu√≠ se puede agregar l√≥gica para enviar resultados
            }

            // Live Leaderboard ‚Äî carga datos desde Supabase
            async updateLiveLeaderboard() {
                if (!this.currentCompetition) return;

                const container = document.getElementById('liveLeaderboardList');
                if (!container) return;

                const lastUpdateEl = document.getElementById('lastUpdateTime');
                if (lastUpdateEl) {
                    lastUpdateEl.textContent = `Actualizado: ${new Date().toLocaleTimeString('es-ES')}`;
                }

                const { data: participants, error } = await this.supabase
                    .from('competition_participants')
                    .select('*')
                    .eq('competition_id', this.currentCompetition.id)
                    .eq('is_active', true)
                    .order('total_score', { ascending: false })
                    .limit(10);

                if (error) return;

                if (!participants || participants.length === 0) {
                    container.innerHTML = `
                        <div style="text-align:center;padding:3rem;color:var(--text-secondary);">
                            <i class="fas fa-users" style="font-size:3rem;margin-bottom:1rem;color:var(--primary);"></i>
                            <h3>Esperando Participantes</h3>
                            <p>Los participantes aparecer√°n aqu√≠ cuando ingresen con el c√≥digo de acceso</p>
                            <p style="margin-top:1rem;font-size:0.9rem;">La tabla se actualiza autom√°ticamente</p>
                        </div>`;
                    return;
                }

                container.innerHTML = '';
                participants.forEach((p, index) => {
                    const item = document.createElement('div');
                    const rankClass = index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : '';
                    item.className = `leaderboard-item ${rankClass}`.trim();
                    if (this.currentParticipant && p.id === this.currentParticipant.id) {
                        item.classList.add('current-participant');
                    }

                    const isMe       = this.currentParticipant && p.id === this.currentParticipant.id;
                    const nameDisplay = isMe ? `${p.name} <span class="current-participant-badge">T√ö</span>` : p.name;
                    const totalProblems = p.problems_solved
                        ? Object.values(p.problems_solved).reduce((a, b) => a + b, 0) : 0;

                    item.innerHTML = `
                        <div class="rank-number">${index + 1}</div>
                        <div class="participant-info">
                            <div class="participant-name">${nameDisplay}</div>
                            <div class="participant-school">${p.school}</div>
                            <div style="font-size:0.8rem;color:var(--text-secondary);margin-top:0.25rem;">
                                <i class="fas fa-fire"></i> Racha: ${p.streak || 0} |
                                <i class="fas fa-tasks"></i> Problemas: ${totalProblems} |
                                <i class="fas fa-clock"></i> ${this.formatTimeAgo(p.last_activity)}
                            </div>
                        </div>
                        <div class="participant-score">${p.total_score} pts</div>`;
                    container.appendChild(item);
                });
            }

            formatTimeAgo(timestamp) {
                if (!timestamp) return 'Reci√©n ingres√≥';
                const diff = Math.floor((Date.now() - new Date(timestamp).getTime()) / 1000);
                if (diff < 30) return 'Ahora mismo';
                if (diff < 60) return 'Hace unos segundos';
                if (diff < 3600) return `Hace ${Math.floor(diff / 60)} min`;
                return `Hace ${Math.floor(diff / 3600)} h`;
            }

            selectArea(area) {
                if (!this.currentParticipant) {
                    alert('Error: No hay participante registrado.');
                    return;
                }

                const areaNames = {
                    'algebra': '√Ålgebra',
                    'geometry': 'Geometr√≠a', 
                    'calculus': 'C√°lculo',
                    'trigonometry': 'Trigonometr√≠a',
                    'mental-calc': 'C√°lculo Mental',
                    'puzzles': 'Acertijos'
                };
                
                // Show coming soon message
                alert(`üìö √Årea de ${areaNames[area]}\n\nüöß PR√ìXIMAMENTE üöß\n\nLos ejercicios para esta √°rea se habilitar√°n en la siguiente fase.\n\nPor ahora puedes:\n‚Ä¢ Ver la tabla de posiciones\n‚Ä¢ Esperar a que se abran los m√≥dulos de ejercicios`);
            }

            createCompetitionParticles() {
                const particlesContainer = document.getElementById('compParticles');
                const particles = ['üèÜ', 'ü•á', 'ü•à', 'ü•â', 'üìä', 'üìà', 'üéØ', '‚ö°', 'üíØ', 'üî•'];
                
                setInterval(() => {
                    const particle = document.createElement('div');
                    particle.className = 'comp-particle trophy';
                    particle.textContent = particles[Math.floor(Math.random() * particles.length)];
                    
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.setProperty('--drift', (Math.random() - 0.5) * 200 + 'px');
                    particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                    particle.style.animationDelay = Math.random() * 2 + 's';
                    
                    particlesContainer.appendChild(particle);
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 25000);
                }, 3000);
            }

            setupAnimations() {
                const observerOptions = {
                    threshold: 0.1,
                    rootMargin: '0px 0px -50px 0px'
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('visible');
                        }
                    });
                }, observerOptions);

                document.querySelectorAll('.fade-in').forEach(el => {
                    observer.observe(el);
                });
            }
        }

        // Initialize competition manager
        const competitionManager = new CompetitionManager();
        
        // Expose globally for other functions
        window.competitionManager = competitionManager;

        // Global functions
        function verifyAccessCode() {
            competitionManager.verifyCode();
        }

        function selectArea(area) {
            competitionManager.selectArea(area);
        }

        // Iniciar cron√≥metro (solo Profesor) ‚Äî Supabase
        async function startCompetitionTimer() {
            const mgr = window.competitionManager;
            if (!mgr || !mgr.currentCompetition) {
                alert('‚ö†Ô∏è Carga la p√°gina antes de iniciar el cron√≥metro.');
                return;
            }

            const accessCode = prompt(
                'üéØ INICIAR CRON√ìMETRO ‚Äî SOLO PROFESOR üéØ\n\n' +
                'Ingresa el c√≥digo de acceso del profesor:'
            );
            if (!accessCode) return;

            const { count: partCount } = await mgr.supabase
                .from('competition_participants')
                .select('*', { count: 'exact', head: true })
                .eq('competition_id', mgr.currentCompetition.id)
                .eq('is_active', true);

            if (!partCount || partCount === 0) {
                alert('‚ö†Ô∏è No hay participantes registrados.\n\nEspera a que al menos un estudiante ingrese antes de iniciar.');
                return;
            }

            const confirmStart = confirm(
                `üöÄ INICIAR COMPETENCIA üöÄ\n\n` +
                `Participantes listos: ${partCount}\n` +
                `Duraci√≥n: 2 horas\n\n` +
                `¬øIniciar el cron√≥metro ahora?\n\n` +
                `‚ö†Ô∏è Una vez iniciado, el tiempo no se puede pausar.`
            );
            if (!confirmStart) return;

            const { data, error } = await mgr.supabase.rpc('start_competition_timer', {
                p_prof_code:      accessCode.toUpperCase(),
                p_competition_id: mgr.currentCompetition.id
            });

            if (error || !data || !data.success) {
                alert('‚ùå ' + (data?.error || 'C√≥digo incorrecto o error al iniciar.'));
                return;
            }

            alert('‚úÖ ¬°Cron√≥metro iniciado!\n\nLa competencia ha comenzado. Todos los participantes ser√°n notificados autom√°ticamente.');
        }

        // Reiniciar competencia (solo Profesor) ‚Äî Supabase
        async function resetCompetition() {
            const mgr = window.competitionManager;
            if (!mgr) return;

            const accessCode = prompt(
                'üîí ACCESO RESTRINGIDO ‚Äî SOLO PROFESOR üîí\n\n' +
                'Ingresa el c√≥digo de acceso del profesor para reiniciar:'
            );
            if (!accessCode) return;

            const confirmReset = confirm(
                '‚ö†Ô∏è ADVERTENCIA ‚ö†Ô∏è\n\n' +
                'Esto eliminar√° TODOS los datos de la competencia:\n' +
                '‚Ä¢ Todos los participantes\n' +
                '‚Ä¢ Todas las puntuaciones\n\n' +
                '¬øEst√°s seguro de que quieres REINICIAR la competencia?'
            );
            if (!confirmReset) return;

            const doubleConfirm = confirm(
                'üî• √öLTIMA CONFIRMACI√ìN üî•\n\n' +
                'Esta acci√≥n NO se puede deshacer.\n' +
                '¬øContinuar con el REINICIO COMPLETO?'
            );
            if (!doubleConfirm) return;

            const { data, error } = await mgr.supabase.rpc('reset_competition', {
                p_prof_code: accessCode.toUpperCase()
            });

            if (error || !data || !data.success) {
                alert('‚ùå ' + (data?.error || 'C√≥digo incorrecto o error al reiniciar.'));
                return;
            }

            if (mgr.timerInterval) clearInterval(mgr.timerInterval);
            localStorage.removeItem('currentParticipant');

            alert('‚úÖ Competencia reiniciada.\n\nTodos los datos han sido eliminados.\nLa p√°gina se recargar√°.');
            location.reload();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && document.querySelector('.code-input:focus')) {
                verifyAccessCode();
            }
        });

        // Auto-focus first input on load
        window.addEventListener('load', () => {
            document.getElementById('code1').focus();
        });

        // Auto-focus first input on load
        window.addEventListener('load', () => {
            const c1 = document.getElementById('code1');
            if (c1) c1.focus();
        });
        // Variables globales para el men√∫ m√≥vil
let mobileMenuOpen = false;

function toggleMobileMenu() {
    const navControls = document.getElementById('navControls');
    const menuBtn = document.querySelector('.mobile-menu-btn');
    
    if (!mobileMenuOpen) {
        openMobileMenu();
    } else {
        closeMobileMenu();
    }
}

function openMobileMenu() {
    const navControls = document.getElementById('navControls');
    const menuBtn = document.querySelector('.mobile-menu-btn');
    const overlay = document.querySelector('.mobile-menu-overlay');
    
    navControls.classList.add('active');
    menuBtn.classList.add('active');
    overlay.style.display = 'block';
    
    // Prevenir scroll del body
    document.body.style.overflow = 'hidden';
    
    mobileMenuOpen = true;
    
    // A√±adir evento para cerrar con Escape
    document.addEventListener('keydown', handleEscapeKey);
}

function closeMobileMenu() {
    const navControls = document.getElementById('navControls');
    const menuBtn = document.querySelector('.mobile-menu-btn');
    const overlay = document.querySelector('.mobile-menu-overlay');
    
    navControls.classList.remove('active');
    menuBtn.classList.remove('active');
    overlay.style.display = 'none';
    
    // Restaurar scroll del body
    document.body.style.overflow = 'auto';
    
    mobileMenuOpen = false;
    
    // Remover evento de Escape
    document.removeEventListener('keydown', handleEscapeKey);
}

// Cerrar men√∫ con tecla Escape
function handleEscapeKey(event) {
    if (event.key === 'Escape' && mobileMenuOpen) {
        closeMobileMenu();
    }
}

// Inicializar eventos del men√∫ responsivo para competencias
function initCompetitionMobileMenu() {
    // Cerrar men√∫ al hacer click en cualquier bot√≥n de navegaci√≥n
    const navButtons = document.querySelectorAll('.nav-back');
    
    navButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            // No cerrar inmediatamente para botones que requieren confirmaci√≥n
            if (this.classList.contains('timer-btn') || this.classList.contains('admin-btn')) {
                // Estos botones tienen confirmaciones, cerrar despu√©s de un delay
                setTimeout(() => {
                    if (mobileMenuOpen) {
                        closeMobileMenu();
                    }
                }, 100);
            } else {
                // Enlaces normales, cerrar inmediatamente
                if (mobileMenuOpen) {
                    closeMobileMenu();
                }
            }
        });
    });
    
    // Cerrar men√∫ al cambiar tama√±o de ventana
    window.addEventListener('resize', function() {
        if (window.innerWidth > 900 && mobileMenuOpen) {
            closeMobileMenu();
        }
    });
    
    // Mejorar accesibilidad del men√∫
    const menuBtn = document.querySelector('.mobile-menu-btn');
    const navControls = document.getElementById('navControls');
    
    if (menuBtn && navControls) {
        menuBtn.setAttribute('aria-expanded', 'false');
        menuBtn.setAttribute('aria-controls', 'navControls');
        
        // Actualizar aria-expanded cuando cambie el estado
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const isActive = navControls.classList.contains('active');
                    menuBtn.setAttribute('aria-expanded', isActive.toString());
                }
            });
        });
        
        observer.observe(navControls, {
            attributes: true,
            attributeFilter: ['class']
        });
    }
    
    // Actualizar estado visual del bot√≥n timer al cargar
    if (window.competitionManager) {
        window.competitionManager.updateTimerButtonState();
    }
}

// Actualizar estado visual del bot√≥n timer
function updateTimerButtonState() {
    const timerBtn = document.querySelector('.timer-btn');
    const started = window.competitionManager?.currentCompetition?.timer_started;

    if (timerBtn && started) {
        timerBtn.innerHTML = '<i class="fas fa-check"></i><span class="btn-text">Timer Iniciado</span><span class="timer-status-indicator"></span>';
        timerBtn.classList.add('started');
        timerBtn.disabled = true;
        timerBtn.style.background = 'var(--success)';
        timerBtn.setAttribute('title', 'El cron√≥metro ya est√° en marcha');
    }
}

// Manejar clics en botones especiales en m√≥vil
function handleSpecialButtonClick(buttonType) {
    // Cerrar men√∫ m√≥vil cuando se hace clic en botones especiales
    if (mobileMenuOpen && window.innerWidth <= 900) {
        setTimeout(() => {
            closeMobileMenu();
        }, 200);
    }
}

// A√±adir manejadores especiales para botones de competencia
function setupCompetitionButtonHandlers() {
    // Timer button
    const timerBtn = document.querySelector('.timer-btn');
    if (timerBtn) {
        const originalOnClick = timerBtn.onclick;
        timerBtn.onclick = function(e) {
            handleSpecialButtonClick('timer');
            if (originalOnClick) {
                originalOnClick.call(this, e);
            }
        };
    }
    
    // Admin button
    const adminBtn = document.querySelector('.admin-btn');
    if (adminBtn) {
        const originalOnClick = adminBtn.onclick;
        adminBtn.onclick = function(e) {
            handleSpecialButtonClick('admin');
            if (originalOnClick) {
                originalOnClick.call(this, e);
            }
        };
    }
}

// Inicializar todo cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
    initCompetitionMobileMenu();
    setupCompetitionButtonHandlers();
});

// Tambi√©n inicializar cuando la ventana se carga completamente
window.addEventListener('load', function() {
    initCompetitionMobileMenu();
    setupCompetitionButtonHandlers();
});
</script>

</body>
</html>