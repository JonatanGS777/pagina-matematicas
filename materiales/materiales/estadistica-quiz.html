<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Estad√≠stica Moderna</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0ea5e9;
            --primary-light: #38bdf8;
            --secondary: #06b6d4;
            --accent: #10b981;
            --tertiary: #6366f1;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --background: #020617;
            --surface: #0f172a;
            --card: #1e293b;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --border: #475569;
            --shadow: rgba(0, 0, 0, 0.25);
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, var(--accent) 100%);
            --gradient-card: linear-gradient(135deg, rgba(14,165,233,0.1) 0%, rgba(6,182,212,0.05) 100%);
            --gradient-data: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 50%, #10b981 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Syne', -apple-system, sans-serif;
            background: var(--background);
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(14, 165, 233, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(6, 182, 212, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 50% 10%, rgba(16, 185, 129, 0.08) 0%, transparent 50%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header con tema de estad√≠stica/datos */
        .quiz-header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
            padding: 2.5rem;
            background: rgba(14, 165, 233, 0.05);
            border-radius: 24px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(14, 165, 233, 0.2);
        }

        .quiz-header::before {
            content: 'œÉ Œº œá¬≤';
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: var(--primary);
            font-weight: 300;
            letter-spacing: 1.5rem;
        }

        .quiz-title {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            background: var(--gradient-data);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
            animation: slideInDown 0.8s ease-out;
        }

        .quiz-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 400;
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }

        /* Barra de progreso con tema de datos */
        .progress-container {
            background: var(--surface);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 2rem 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(14, 165, 233, 0.1);
            animation: fadeInUp 0.8s ease-out 0.4s both;
            position: relative;
        }

        .progress-container::before {
            content: 'Œ£';
            position: absolute;
            top: 10px;
            right: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            color: var(--primary);
            opacity: 0.6;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .question-counter {
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .score-display {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--accent);
            font-weight: 600;
        }

        .progress-bar {
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }

        .progress {
            height: 100%;
            background: var(--gradient-data);
            border-radius: 5px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        /* Tarjeta de pregunta con estilo de datos */
        .question-card {
            background: var(--gradient-card);
            backdrop-filter: blur(25px);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(14, 165, 233, 0.2);
            box-shadow: 0 25px 50px var(--shadow);
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.6s ease-out;
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-data);
        }

        .question-card::after {
            content: 'üìä';
            position: absolute;
            top: 20px;
            right: 25px;
            font-size: 1.5rem;
            opacity: 0.1;
        }

        .category-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(14, 165, 233, 0.2);
            color: var(--primary);
            padding: 0.6rem 1.2rem;
            border-radius: 30px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(14, 165, 233, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            line-height: 1.8;
            white-space: pre-line;
        }

        /* Tabla de datos moderna */
        .data-table {
            width: 100%;
            margin: 1.5rem 0;
            border-collapse: separate;
            border-spacing: 0;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(14, 165, 233, 0.2);
        }

        .data-table th {
            background: var(--gradient-primary);
            color: white;
            padding: 1rem;
            font-weight: 600;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
        }

        .data-table td {
            padding: 0.8rem;
            text-align: center;
            border-bottom: 1px solid rgba(14, 165, 233, 0.1);
            font-family: 'JetBrains Mono', monospace;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        /* Opciones modernas */
        .options-grid {
            display: grid;
            gap: 1rem;
            margin-top: 2rem;
        }

        .option {
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid transparent;
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-family: 'JetBrains Mono', monospace;
        }

        .option-letter {
            background: var(--gradient-primary);
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .option-content {
            flex: 1;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(14,165,233,0.1), transparent);
            transition: left 0.5s ease;
        }

        .option:hover {
            background: rgba(14, 165, 233, 0.1);
            border-color: var(--primary);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 30px rgba(14, 165, 233, 0.2);
        }

        .option:hover::before {
            left: 100%;
        }

        .option.selected {
            background: rgba(14, 165, 233, 0.2);
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
        }

        /* Input estad√≠stico moderno */
        .input-group {
            position: relative;
            margin-top: 2rem;
        }

        .input-answer {
            width: 100%;
            padding: 1.2rem 1.8rem;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(14, 165, 233, 0.2);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 1.1rem;
            font-family: 'JetBrains Mono', monospace;
            transition: all 0.3s ease;
        }

        .input-answer:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(14, 165, 233, 0.05);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
        }

        .input-answer::placeholder {
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Botones con tema de datos */
        .button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.2rem 2.5rem;
            border-radius: 16px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            margin-top: 1.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(14, 165, 233, 0.4);
        }

        .button:active {
            transform: translateY(0);
        }

        .button-secondary {
            background: var(--gradient-secondary);
        }

        .button-secondary:hover {
            box-shadow: 0 20px 40px rgba(6, 182, 212, 0.4);
        }

        .button-outline {
            background: var(--surface);
            border: 2px solid var(--border);
        }

        .button-outline:hover {
            background: var(--card);
            border-color: var(--primary);
            box-shadow: 0 15px 30px var(--shadow);
        }

        /* Feedback con estilo estad√≠stico */
        .feedback {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 16px;
            display: none;
            position: relative;
            animation: slideInUp 0.4s ease-out;
            font-weight: 500;
        }

        .feedback.correct {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .feedback.correct::before {
            content: 'œÉ ‚úì';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.2rem;
        }

        .feedback.incorrect {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        .feedback.incorrect::before {
            content: 'œá¬≤ ‚úó';
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.2rem;
        }

        /* Resultados finales con estilo de an√°lisis */
        .results-card {
            text-align: center;
            animation: zoomIn 0.6s ease-out;
            position: relative;
        }

        .results-card::before {
            content: 'üìà üìä üìâ';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            opacity: 0.3;
            letter-spacing: 1rem;
        }

        .results-score {
            font-size: 4.5rem;
            font-weight: 700;
            background: var(--gradient-data);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 2rem 0;
            font-family: 'JetBrains Mono', monospace;
        }

        .results-message {
            font-size: 1.3rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .results-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .results-breakdown {
            background: rgba(14, 165, 233, 0.05);
            border-radius: 16px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: left;
            border: 1px solid rgba(14, 165, 233, 0.1);
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(14, 165, 233, 0.1);
            font-family: 'JetBrains Mono', monospace;
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-category {
            font-weight: 500;
        }

        .breakdown-score {
            font-weight: 600;
            color: var(--primary);
        }

        /* Indicadores estad√≠sticos */
        .stat-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(14, 165, 233, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        .stat-high { color: var(--success); }
        .stat-medium { color: var(--warning); }
        .stat-low { color: var(--danger); }

        /* Animaciones */
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .question-card {
                padding: 2rem;
            }

            .quiz-title {
                font-size: 2.5rem;
            }

            .results-actions {
                flex-direction: column;
            }

            .option {
                flex-direction: column;
                text-align: center;
                gap: 0.75rem;
            }

            .progress-info {
                justify-content: center;
                text-align: center;
            }
        }

        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(14,165,233,.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="quiz-header">
            <h1 class="quiz-title">Prueba de Estad√≠stica</h1>
            <p class="quiz-subtitle">Analiza datos y descubre patrones ocultos</p>
        </header>

        <section class="progress-container">
            <div class="progress-info">
                <div class="question-counter">
                    <i class="fas fa-chart-bar"></i>
                    Pregunta <span id="current-question">1</span> de <span id="total-questions">15</span>
                </div>
                <div class="score-display">
                    <i class="fas fa-percentage"></i>
                    <span id="current-score">0</span> puntos
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </section>

        <main id="questions"></main>

        <div class="quiz-controls">
            <button class="button" id="next-button" onclick="nextQuestion()">
                <span>Siguiente Pregunta</span>
                <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <script>
        const questions = [
            {
                category: "Estad√≠stica Descriptiva",
                icon: "fa-list-alt",
                question: "Dados los valores: 2, 4, 4, 4, 5, 5, 6, 7, 7, 8. ¬øCu√°l es la moda?",
                type: "input",
                answer: "4",
                hint: "Busca el valor que m√°s se repite"
            },
            {
                category: "Estad√≠stica Descriptiva",
                icon: "fa-calculator",
                question: "Calcula la media de los siguientes datos: 10, 15, 20, 25, 30",
                type: "input",
                answer: "20",
                hint: "Suma todos los valores y divide entre la cantidad de datos"
            },
            {
                category: "Estad√≠stica Descriptiva",
                icon: "fa-balance-scale",
                question: "En un conjunto de datos, ¬øqu√© medida de tendencia central es m√°s sensible a valores extremos?",
                type: "multiple",
                options: [
                    "Media",
                    "Mediana",
                    "Moda",
                    "Rango"
                ],
                correct: 0
            },
            {
                category: "Probabilidad",
                icon: "fa-dice",
                question: "Al lanzar dos dados, ¬øcu√°l es la probabilidad de obtener una suma de 7?",
                type: "input",
                answer: "1/6",
                hint: "Hay 36 resultados posibles. Cuenta los casos favorables"
            },
            {
                category: "Probabilidad",
                icon: "fa-intersection",
                question: "Si P(A) = 0.3 y P(B) = 0.4, y los eventos son independientes, ¬øcu√°l es P(A ‚à© B)?",
                type: "input",
                answer: "0.12",
                hint: "Para eventos independientes, multiplica las probabilidades"
            },
            {
                category: "Probabilidad",
                icon: "fa-theorem",
                question: "¬øQu√© teorema se usa para calcular la probabilidad de A dado B?",
                type: "multiple",
                options: [
                    "Teorema de Bayes",
                    "Teorema del L√≠mite Central",
                    "Regla de la Suma",
                    "Regla del Producto"
                ],
                correct: 0
            },
            {
                category: "Estad√≠stica Inferencial",
                icon: "fa-target",
                question: "¬øQu√© nivel de confianza corresponde a un valor z de 1.96?",
                type: "input",
                answer: "95",
                hint: "Es uno de los niveles de confianza m√°s utilizados"
            },
            {
                category: "Estad√≠stica Inferencial",
                icon: "fa-question-circle",
                question: "En una prueba de hip√≥tesis, ¬øqu√© representa el valor p?",
                type: "multiple",
                options: [
                    "La probabilidad de obtener resultados tan extremos como los observados si H‚ÇÄ es verdadera",
                    "La probabilidad de que H‚ÇÄ sea verdadera",
                    "La probabilidad de que H‚ÇÅ sea verdadera",
                    "El nivel de confianza"
                ],
                correct: 0
            },
            {
                category: "Estad√≠stica Inferencial",
                icon: "fa-exclamation-triangle",
                question: "¬øQu√© tipo de error ocurre cuando rechazamos H‚ÇÄ siendo verdadera?",
                type: "multiple",
                options: [
                    "Error Tipo I",
                    "Error Tipo II",
                    "Error est√°ndar",
                    "Error muestral"
                ],
                correct: 0
            },
            {
                category: "An√°lisis de Datos",
                icon: "fa-chart-scatter",
                question: "¬øQu√© gr√°fico es m√°s apropiado para mostrar la relaci√≥n entre dos variables continuas?",
                type: "multiple",
                options: [
                    "Diagrama de dispersi√≥n",
                    "Gr√°fico de barras",
                    "Gr√°fico circular",
                    "Histograma"
                ],
                correct: 0
            },
            {
                category: "An√°lisis de Datos",
                icon: "fa-link",
                question: "Si el coeficiente de correlaci√≥n es -0.9, esto indica:",
                type: "multiple",
                options: [
                    "Una fuerte correlaci√≥n negativa",
                    "Una d√©bil correlaci√≥n negativa",
                    "Una fuerte correlaci√≥n positiva",
                    "No hay correlaci√≥n"
                ],
                correct: 0
            },
            {
                category: "Estad√≠stica Inferencial",
                icon: "fa-graduation-cap",
                question: "Para una muestra de 100 observaciones, ¬øcu√°ntos grados de libertad tiene la distribuci√≥n t?",
                type: "input",
                answer: "99",
                hint: "Es n-1, donde n es el tama√±o de la muestra"
            },
            {
                category: "Probabilidad",
                icon: "fa-bell",
                question: "En una distribuci√≥n normal est√°ndar, ¬øqu√© porcentaje de datos cae dentro de dos desviaciones est√°ndar?",
                type: "input",
                answer: "95",
                hint: "Es la regla 68-95-99.7"
            },
            {
                category: "An√°lisis de Datos",
                icon: "fa-arrows-alt-h",
                question: "¬øQu√© medida se usa para cuantificar la dispersi√≥n de los datos respecto a la media?",
                type: "multiple",
                options: [
                    "Desviaci√≥n est√°ndar",
                    "Mediana",
                    "Moda",
                    "Media"
                ],
                correct: 0
            },
            {
                category: "Estad√≠stica Descriptiva",
                icon: "fa-chart-box",
                question: "En un conjunto de datos, el primer cuartil (Q1) es 10 y el tercer cuartil (Q3) es 30. ¬øCu√°l es el rango intercuart√≠lico?",
                type: "input",
                answer: "20",
                hint: "RIC = Q3 - Q1"
            }
        ];

        let currentQuestion = 0;
        let score = 0;
        let userAnswers = [];
        let startTime = new Date();

        function loadQuestion() {
            const questionDiv = document.getElementById('questions');
            const question = questions[currentQuestion];

            let html = `
                <article class="question-card">
                    <div class="category-badge">
                        <i class="fas ${question.icon}"></i>
                        ${question.category}
                    </div>
                    <h2 class="question-text">${question.question}</h2>
            `;

            if (question.type === 'multiple') {
                html += `<div class="options-grid">`;
                question.options.forEach((option, index) => {
                    html += `
                        <div class="option" onclick="selectOption(${index})" id="option-${index}">
                            <span class="option-letter">${String.fromCharCode(65 + index)}</span>
                            <span class="option-content">${option}</span>
                        </div>
                    `;
                });
                html += `</div>`;
                html += `<button class="button" onclick="checkAnswer()" id="check-btn" style="display:none;">
                    <i class="fas fa-check"></i> Verificar Respuesta
                </button>`;
            } else {
                html += `
                    <div class="input-group">
                        <input type="text" class="input-answer" id="user-answer" 
                               placeholder="Ejemplo: 20, 1/6, 0.12, 95%" autocomplete="off">
                    </div>
                    <button class="button" onclick="checkAnswer()">
                        <i class="fas fa-chart-line"></i> Verificar Respuesta
                    </button>
                `;
            }

            html += `<div class="feedback" id="feedback"></div></article>`;
            questionDiv.innerHTML = html;

            // Actualizar elementos de UI
            document.getElementById('current-question').textContent = currentQuestion + 1;
            document.getElementById('total-questions').textContent = questions.length;
            document.getElementById('current-score').textContent = score;
            document.getElementById('progress').style.width = `${((currentQuestion + 1) / questions.length) * 100}%`;

            // Renderizar f√≥rmulas matem√°ticas
            if (window.MathJax) {
                MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
            }

            // Agregar event listener para Enter en inputs
            const input = document.getElementById('user-answer');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        checkAnswer();
                    }
                });
                input.focus();
            }
        }

        let selectedOptionIndex = null;

        function selectOption(index) {
            // Limpiar selecciones previas
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            
            // Seleccionar nueva opci√≥n
            document.getElementById(`option-${index}`).classList.add('selected');
            selectedOptionIndex = index;
            
            // Mostrar bot√≥n de verificaci√≥n
            document.getElementById('check-btn').style.display = 'inline-flex';
        }

        function normalizeStatisticalAnswer(answer) {
            return answer.toLowerCase()
                .replace(/\s+/g, '')
                .replace(/%/g, '')
                .replace(/‚ÇÄ/g, '0')
                .replace(/‚ÇÅ/g, '1')
                .replace(/‚ÇÇ/g, '2');
        }

        function checkAnswer(selectedOption = null) {
            const question = questions[currentQuestion];
            const feedback = document.getElementById('feedback');
            let isCorrect = false;
            let userAnswer = '';

            if (question.type === 'multiple') {
                userAnswer = selectedOptionIndex !== null ? question.options[selectedOptionIndex] : '';
                isCorrect = selectedOptionIndex === question.correct;
            } else {
                userAnswer = document.getElementById('user-answer').value.trim();
                
                // Normalizar respuestas para comparaci√≥n flexible en estad√≠stica
                const normalizedUser = normalizeStatisticalAnswer(userAnswer);
                const normalizedCorrect = normalizeStatisticalAnswer(question.answer);
                
                // Verificaci√≥n para diferentes tipos de respuestas estad√≠sticas
                if (normalizedCorrect.includes('/')) {
                    // Para fracciones como 1/6
                    isCorrect = normalizedUser === normalizedCorrect;
                } else if (normalizedCorrect.includes('.')) {
                    // Para decimales como 0.12
                    const userNum = parseFloat(userAnswer);
                    const correctNum = parseFloat(question.answer);
                    if (!isNaN(userNum) && !isNaN(correctNum)) {
                        isCorrect = Math.abs(userNum - correctNum) < 0.001;
                    }
                } else {
                    // Para n√∫meros enteros y porcentajes
                    const userNum = parseFloat(userAnswer.replace('%', ''));
                    const correctNum = parseFloat(question.answer);
                    if (!isNaN(userNum) && !isNaN(correctNum)) {
                        isCorrect = Math.abs(userNum - correctNum) < 0.1;
                    } else {
                        isCorrect = normalizedUser === normalizedCorrect;
                    }
                }
            }

            // Guardar respuesta del usuario
            userAnswers.push({
                question: question.question,
                userAnswer: userAnswer,
                correctAnswer: question.type === 'multiple' ? question.options[question.correct] : question.answer,
                isCorrect: isCorrect,
                category: question.category
            });

            feedback.style.display = 'block';
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            
            if (isCorrect) {
                score++;
                const encouragement = [
                    '¬°Excelente an√°lisis! Tu comprensi√≥n estad√≠stica es s√≥lida.',
                    '¬°Correcto! Dominas los conceptos de probabilidad y datos.',
                    '¬°Perfecto! Tu razonamiento estad√≠stico es preciso.',
                    '¬°Brillante! Contin√∫a con esa precisi√≥n anal√≠tica.'
                ];
                feedback.innerHTML = `
                    <i class="fas fa-check-circle"></i>
                    <strong>${encouragement[Math.floor(Math.random() * encouragement.length)]}</strong>
                `;
            } else {
                feedback.innerHTML = `
                    <i class="fas fa-times-circle"></i>
                    <strong>Incorrecto.</strong> En estad√≠stica, cada detalle cuenta.
                    ${question.hint ? `<br><em>Pista: ${question.hint}</em>` : ''}
                    <br>Respuesta correcta: <strong>${question.type === 'multiple' ? question.options[question.correct] : question.answer}</strong>
                `;
            }

            // Deshabilitar interacciones despu√©s de responder
            document.querySelectorAll('.option').forEach(opt => opt.style.pointerEvents = 'none');
            const input = document.getElementById('user-answer');
            if (input) input.disabled = true;
        }

        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                selectedOptionIndex = null;
                loadQuestion();
            } else {
                showResults();
            }
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // T√≠tulo
            doc.setFontSize(20);
            doc.text('Resultados de la Prueba de Estadistica', 20, 30);
            
            // Informaci√≥n general
            const endTime = new Date();
            const duration = Math.round((endTime - startTime) / 1000 / 60);
            const percentage = (score / questions.length * 100).toFixed(1);
            
            doc.setFontSize(14);
            doc.text(`Fecha: ${new Date().toLocaleDateString()}`, 20, 50);
            doc.text(`Duracion: ${duration} minutos`, 20, 60);
            doc.text(`Puntuacion: ${score} de ${questions.length} (${percentage}%)`, 20, 70);
            
            // An√°lisis estad√≠stico del desempe√±o
            let analysisText = '';
            if (percentage >= 90) analysisText = 'Dominio excepcional del analisis estadistico y probabilistico';
            else if (percentage >= 80) analysisText = 'Solida comprension de conceptos estadisticos fundamentales';
            else if (percentage >= 70) analysisText = 'Base adecuada, requiere refuerzo en inferencia estadistica';
            else if (percentage >= 60) analysisText = 'Conocimientos basicos, necesita mas practica con probabilidad';
            else analysisText = 'Requiere estudio intensivo de conceptos estadisticos fundamentales';
            
            doc.setFontSize(12);
            doc.text(`Analisis: ${analysisText}`, 20, 85);
            
            // Resultados por √°rea estad√≠stica
            const categories = {};
            userAnswers.forEach(answer => {
                if (!categories[answer.category]) {
                    categories[answer.category] = { correct: 0, total: 0 };
                }
                categories[answer.category].total++;
                if (answer.isCorrect) categories[answer.category].correct++;
            });
            
            doc.setFontSize(16);
            doc.text('Resultados por Area Estadistica:', 20, 110);
            
            let yPosition = 125;
            doc.setFontSize(11);
            Object.entries(categories).forEach(([category, stats]) => {
                const categoryPercentage = (stats.correct / stats.total * 100).toFixed(1);
                doc.text(`${category}: ${stats.correct}/${stats.total} (${categoryPercentage}%)`, 25, yPosition);
                yPosition += 8;
            });
            
            // Recomendaciones espec√≠ficas
            yPosition += 15;
            doc.setFontSize(14);
            doc.text('Recomendaciones:', 20, yPosition);
            yPosition += 10;
            
            doc.setFontSize(10);
            const recommendations = [];
            Object.entries(categories).forEach(([category, stats]) => {
                const percentage = (stats.correct / stats.total * 100);
                if (percentage < 70) {
                    recommendations.push(`Reforzar: ${category}`);
                }
            });
            
            if (recommendations.length === 0) {
                doc.text('Excelente dominio en todas las areas estadisticas.', 25, yPosition);
            } else {
                recommendations.forEach(rec => {
                    doc.text(`‚Ä¢ ${rec}`, 25, yPosition);
                    yPosition += 6;
                });
            }
            
            // Respuestas detalladas
            yPosition += 15;
            doc.setFontSize(16);
            doc.text('Revision Detallada:', 20, yPosition);
            yPosition += 15;
            
            doc.setFontSize(9);
            userAnswers.forEach((answer, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 30;
                }
                
                doc.text(`${index + 1}. ${answer.question.substring(0, 70)}...`, 20, yPosition);
                yPosition += 6;
                doc.text(`Tu respuesta: ${answer.userAnswer || 'Sin respuesta'}`, 25, yPosition);
                yPosition += 6;
                doc.text(`Correcta: ${answer.correctAnswer}`, 25, yPosition);
                yPosition += 6;
                doc.text(`Estado: ${answer.isCorrect ? 'CORRECTA' : 'INCORRECTA'}`, 25, yPosition);
                yPosition += 12;
            });
            
            // Descargar PDF
            doc.save(`resultados-estadistica-${new Date().toISOString().split('T')[0]}.pdf`);
        }

        function showResults() {
            const questionDiv = document.getElementById('questions');
            const percentage = (score / questions.length) * 100;
            const endTime = new Date();
            const duration = Math.round((endTime - startTime) / 1000 / 60);
            
            // Calcular estad√≠sticas por categor√≠a
            const categories = {};
            userAnswers.forEach(answer => {
                if (!categories[answer.category]) {
                    categories[answer.category] = { correct: 0, total: 0 };
                }
                categories[answer.category].total++;
                if (answer.isCorrect) categories[answer.category].correct++;
            });
            
            let message = '';
            let emoji = '';
            let analysis = '';
            let statisticalLevel = '';
            
            if (percentage >= 95) {
                message = '¬°Eres un experto en estad√≠stica! An√°lisis magistral.';
                emoji = 'üìä';
                analysis = 'Tienes un dominio excepcional de probabilidad, inferencia y an√°lisis de datos.';
                statisticalLevel = 'Nivel: Estad√≠stico Senior';
            } else if (percentage >= 85) {
                message = '¬°Excelente an√°lisis estad√≠stico! Muy s√≥lido.';
                emoji = 'üìà';
                analysis = 'Demuestras gran habilidad en interpretaci√≥n de datos y probabilidad.';
                statisticalLevel = 'Nivel: Analista Avanzado';
            } else if (percentage >= 75) {
                message = '¬°Buen dominio estad√≠stico! Bases fuertes.';
                emoji = 'üìâ';
                analysis = 'Tienes fundamentos buenos, algunos conceptos necesitan refuerzo.';
                statisticalLevel = 'Nivel: Analista Intermedio';
            } else if (percentage >= 65) {
                message = 'Progreso aceptable. Enf√≥cate en conceptos clave.';
                emoji = 'üìã';
                analysis = 'Necesitas fortalecer conceptos de inferencia estad√≠stica.';
                statisticalLevel = 'Nivel: Estudiante Avanzado';
            } else {
                message = 'La estad√≠stica requiere m√°s pr√°ctica. ¬°Persiste!';
                emoji = 'üìö';
                analysis = 'Es recomendable revisar desde conceptos b√°sicos de probabilidad.';
                statisticalLevel = 'Nivel: Estudiante Principiante';
            }

            let categoryBreakdown = '';
            Object.entries(categories).forEach(([category, stats]) => {
                const catPercentage = (stats.correct / stats.total * 100).toFixed(1);
                let indicator = '';
                let indicatorClass = '';
                
                if (catPercentage >= 80) {
                    indicator = 'üü¢ Excelente';
                    indicatorClass = 'stat-high';
                } else if (catPercentage >= 60) {
                    indicator = 'üü° Bueno';
                    indicatorClass = 'stat-medium';
                } else {
                    indicator = 'üî¥ Necesita mejora';
                    indicatorClass = 'stat-low';
                }
                
                categoryBreakdown += `
                    <div class="breakdown-item">
                        <span class="breakdown-category">${category}</span>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span class="breakdown-score">${stats.correct}/${stats.total} (${catPercentage}%)</span>
                            <span class="stat-indicator ${indicatorClass}">${indicator}</span>
                        </div>
                    </div>
                `;
            });
            
            questionDiv.innerHTML = `
                <article class="question-card results-card">
                    <div class="category-badge">
                        <i class="fas fa-chart-pie"></i>
                        An√°lisis Estad√≠stico Final
                    </div>
                    
                    <div class="results-score">${percentage.toFixed(1)}%</div>
                    
                    <div class="results-message">
                        <p><strong>${emoji} ${message}</strong></p>
                        <p style="margin: 1rem 0; font-style: italic; color: var(--primary);">${statisticalLevel}</p>
                        <p style="margin: 1rem 0;">${analysis}</p>
                        <p>Has respondido correctamente <strong>${score}</strong> de ${questions.length} preguntas.</p>
                        <p>Tiempo empleado: <strong>${duration} minutos</strong>.</p>
                    </div>

                    <div class="results-breakdown">
                        <h3 style="margin-bottom: 1.5rem; color: var(--primary); display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-analytics"></i> An√°lisis por √Årea Estad√≠stica
                        </h3>
                        ${categoryBreakdown}
                    </div>
                    
                    <div class="results-actions">
                        <button class="button" onclick="location.reload()">
                            <i class="fas fa-redo"></i>
                            Nueva Evaluaci√≥n
                        </button>
                        <button class="button button-secondary" onclick="generatePDF()">
                            <i class="fas fa-download"></i>
                            Descargar Reporte
                        </button>
                        <button class="button button-outline" onclick="showDetailedReview()">
                            <i class="fas fa-search-plus"></i>
                            An√°lisis Detallado
                        </button>
                    </div>
                </article>
            `;

            document.getElementById('next-button').style.display = 'none';
            document.getElementById('current-score').textContent = score;
        }

        function showDetailedReview() {
            const questionDiv = document.getElementById('questions');
            
            let reviewHtml = `
                <article class="question-card">
                    <div class="category-badge">
                        <i class="fas fa-microscope"></i>
                        An√°lisis Detallado por Pregunta
                    </div>
                    <h2 class="question-text">Revisi√≥n Completa del Desempe√±o</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        Examina cada respuesta para identificar patrones de comprensi√≥n y √°reas de oportunidad.
                    </p>
            `;

            userAnswers.forEach((answer, index) => {
                const statusIcon = answer.isCorrect ? 'fas fa-check-circle' : 'fas fa-times-circle';
                const statusColor = answer.isCorrect ? 'var(--success)' : 'var(--danger)';
                const bgColor = answer.isCorrect ? 'rgba(34, 197, 94, 0.05)' : 'rgba(239, 68, 68, 0.05)';
                
                reviewHtml += `
                    <div style="background: ${bgColor}; border-radius: 12px; padding: 1.5rem; margin: 1rem 0; border-left: 4px solid ${statusColor};">
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; flex-wrap: wrap;">
                            <i class="${statusIcon}" style="color: ${statusColor}; font-size: 1.2rem;"></i>
                            <strong style="color: var(--primary);">Pregunta ${index + 1}</strong>
                            <span style="background: rgba(14,165,233,0.2); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.75rem; color: var(--primary);">
                                ${answer.category}
                            </span>
                        </div>
                        <p style="margin-bottom: 0.75rem; color: var(--text-secondary); font-style: italic;">${answer.question}</p>
                        <div style="display: grid; gap: 0.5rem; font-family: 'JetBrains Mono', monospace;">
                            <p><strong style="color: var(--text-primary);">Tu respuesta:</strong> 
                               <span style="color: ${statusColor};">${answer.userAnswer || 'Sin respuesta'}</span></p>
                            <p><strong style="color: var(--text-primary);">Respuesta correcta:</strong> 
                               <span style="color: var(--success);">${answer.correctAnswer}</span></p>
                        </div>
                    </div>
                `;
            });

            reviewHtml += `
                    <div class="results-actions" style="margin-top: 3rem;">
                        <button class="button" onclick="showResults()">
                            <i class="fas fa-arrow-left"></i>
                            Volver a Resultados
                        </button>
                        <button class="button button-secondary" onclick="generatePDF()">
                            <i class="fas fa-file-pdf"></i>
                            Exportar Reporte
                        </button>
                    </div>
                </article>
            `;

            questionDiv.innerHTML = reviewHtml;
        }

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            startTime = new Date();
            loadQuestion();
        });

        // Prevenir el env√≠o del formulario por defecto
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'INPUT') {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>