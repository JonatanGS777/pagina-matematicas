<!DOCTYPE html>
<html lang="es" class="no-js">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finanzas Inteligentes: Tu Guía Interactiva</title>
    
    <!-- MathJax Configuration -->
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']]
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <!-- Embedded CSS -->
    <style>
        /* ------------------- */
        /* VARIABLES Y RESET   */
        /* ------------------- */
        :root {
            /* Nueva Paleta de Colores: Violeta y Verde */
            --color-bg: #f3f4f6;
            --color-surface: #ffffff;
            --color-primary: #6d28d9; /* Violeta Principal */
            --color-secondary: #16a34a; /* Verde Secundario */
            --color-accent: #f59e0b; /* Acento Ámbar */
            --color-text-primary: #111827;
            --color-text-secondary: #4b5563;
            --color-border: #e5e7eb;
            --color-glass-bg: rgba(243, 244, 246, 0.8);
            --color-hero-blob1: #a78bfa; /* Violeta Claro */
            --color-hero-blob2: #bef264; /* Verde Lima */
            --color-success: #16a34a;
            --color-alert: #dc2626;
            --color-shadow-light: rgba(255, 255, 255, 0.8);
            --color-shadow-dark: rgba(163, 177, 198, 0.6);

            /* Tipografía */
            --font-family-sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            --font-size-base: clamp(1rem, 0.95rem + 0.25vw, 1.125rem);
            --font-size-h1: clamp(2.5rem, 1.5rem + 5vw, 4.5rem);
            --font-size-h2: clamp(2rem, 1.25rem + 3.75vw, 3.5rem);
            --font-size-h3: clamp(1.5rem, 1.1rem + 2vw, 2.25rem);
            --font-size-small: 0.875rem;

            /* Espaciado */
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-xxl: 4rem;

            /* Otros */
            --border-radius: 12px;
            --transition-speed: 0.3s;
        }

        .dark-mode {
            --color-bg: #111827;
            --color-surface: #1f2937;
            --color-primary: #a78bfa; /* Violeta Claro */
            --color-secondary: #4ade80; /* Verde Brillante */
            --color-accent: #f59e0b;
            --color-text-primary: #f9fafb;
            --color-text-secondary: #9ca3af;
            --color-border: #374151;
            --color-glass-bg: rgba(31, 41, 55, 0.8);
            --color-hero-blob1: #5b21b6; /* Violeta Oscuro */
            --color-hero-blob2: #4d7c0f; /* Verde Oscuro */
            --color-success: #4ade80;
            --color-alert: #f87171;
            --color-shadow-light: rgba(42, 52, 78, 0.8);
            --color-shadow-dark: rgba(0, 0, 0, 0.6);
        }

        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth;
            font-size: var(--font-size-base);
        }
        
        html.no-js .js-only {
            display: none;
        }

        body {
            font-family: var(--font-family-sans);
            background-color: var(--color-bg);
            color: var(--color-text-primary);
            line-height: 1.6;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }

        h1, h2, h3 {
            line-height: 1.2;
            font-weight: 700;
            color: var(--color-primary);
        }
        h1 { font-size: var(--font-size-h1); }
        h2 { font-size: var(--font-size-h2); margin-block: var(--spacing-xl) var(--spacing-lg); }
        h3 { font-size: var(--font-size-h3); margin-block: var(--spacing-lg) var(--spacing-md); }

        a {
            color: var(--color-secondary);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }
        a:hover, a:focus {
            color: var(--color-accent);
            text-decoration: underline;
        }

        .skip-link {
            position: absolute;
            top: -100px;
            left: 1rem;
            background: var(--color-accent);
            color: var(--color-bg);
            padding: var(--spacing-sm);
            z-index: 10000;
            transition: top 0.3s ease-in-out;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        .skip-link:focus {
            top: 0;
        }

        @media (prefers-reduced-motion: reduce) {
            html { scroll-behavior: auto; }
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* --- Header y Navegación --- */
        .main-header {
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: var(--spacing-md) 0;
            background-color: var(--color-glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--color-border);
            transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease;
        }
        .main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--color-text-primary);
        }
        .logo svg {
            width: 32px;
            height: 32px;
            fill: var(--color-primary);
            transition: fill var(--transition-speed) ease;
        }
        .main-nav ul {
            display: flex;
            list-style: none;
            gap: var(--spacing-lg);
        }
        .main-nav a {
            font-weight: 500;
            padding: var(--spacing-sm) 0;
            position: relative;
            color: var(--color-text-secondary);
        }
        .main-nav a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--color-accent);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform var(--transition-speed) ease;
        }
        .main-nav a:hover::after,
        .main-nav a:focus::after,
        .main-nav a.active::after {
            transform: scaleX(1);
            transform-origin: left;
        }
        .main-nav a.active {
            color: var(--color-text-primary);
        }
        .header-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        .theme-toggle {
            background: none;
            border: none;
            cursor: pointer;
            width: 44px;
            height: 44px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--color-text-primary);
            border-radius: 50%;
            transition: background-color var(--transition-speed) ease;
        }
        .theme-toggle:hover, .theme-toggle:focus-visible {
            background-color: var(--color-border);
        }
        .theme-toggle svg {
            width: 24px;
            height: 24px;
            transition: transform 0.3s ease;
        }
        .theme-toggle .moon-icon { display: block; }
        .theme-toggle .sun-icon { display: none; }
        .dark-mode .theme-toggle .moon-icon { display: none; }
        .dark-mode .theme-toggle .sun-icon { display: block; }

        /* --- Mobile Navigation --- */
        .nav-toggle {
            display: none;
            z-index: 1001;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            position: relative;
        }
        .nav-toggle span {
            display: block;
            width: 100%;
            height: 3px;
            background-color: var(--color-text-primary);
            border-radius: 3px;
            position: absolute;
            left: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .nav-toggle span:nth-child(1) { top: 3px; }
        .nav-toggle span:nth-child(2) { top: 10.5px; }
        .nav-toggle span:nth-child(3) { bottom: 3px; }

        @media (max-width: 800px) {
            .main-nav ul {
                display: none;
            }
            .nav-toggle {
                display: block;
            }
            .main-nav {
                position: fixed;
                top: 0;
                right: 0;
                width: min(80vw, 300px);
                height: 100vh;
                background-color: var(--color-surface);
                padding: var(--spacing-xxl) var(--spacing-lg);
                transform: translateX(100%);
                transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1);
                box-shadow: -5px 0 15px rgba(0,0,0,0.1);
                border-left: 1px solid var(--color-border);
            }
            body.nav-open .main-nav {
                transform: translateX(0);
            }
            body.nav-open .main-nav ul {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                gap: var(--spacing-lg);
            }
            body.nav-open .main-nav a {
                font-size: 1.2rem;
            }
            body.nav-open .nav-toggle span:nth-child(1) {
                transform: translateY(7.5px) rotate(45deg);
            }
            body.nav-open .nav-toggle span:nth-child(2) {
                opacity: 0;
            }
            body.nav-open .nav-toggle span:nth-child(3) {
                transform: translateY(-7.5px) rotate(-45deg);
            }
        }

        /* --- Hero Section --- */
        .hero {
            position: relative;
            padding: var(--spacing-xxl) 0;
            text-align: center;
            overflow: hidden;
            min-height: 60vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .hero::before, .hero::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -1;
        }
        .hero::before {
            width: 30vw;
            height: 30vw;
            min-width: 200px;
            min-height: 200px;
            background: var(--color-hero-blob1);
            top: 10%;
            left: 15%;
            animation: blob-move 20s infinite alternate;
        }
        .hero::after {
            width: 25vw;
            height: 25vw;
            min-width: 150px;
            min-height: 150px;
            background: var(--color-hero-blob2);
            bottom: 10%;
            right: 15%;
            animation: blob-move 25s infinite alternate-reverse;
        }

        @keyframes blob-move {
            from { transform: translate(-20%, -10%) scale(1); }
            to { transform: translate(20%, 10%) scale(1.2); }
        }

        .hero h1 {
            margin-bottom: var(--spacing-md);
        }
        .hero p {
            font-size: 1.25rem;
            color: var(--color-text-secondary);
            max-width: 60ch;
            margin: 0 auto var(--spacing-xl);
        }

        /* --- Botones --- */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--border-radius);
            font-weight: 600;
            text-decoration: none;
            border: none;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }
        .btn-primary {
            background-color: var(--color-primary);
            color: #fff;
        }
        .btn-primary:hover, .btn-primary:focus-visible {
            background-color: var(--color-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(109, 40, 217, 0.3);
            color: #fff;
        }
        .btn-secondary {
             background-color: var(--color-surface);
             color: var(--color-primary);
             border: 1px solid var(--color-border);
        }
        .btn-secondary:hover {
            transform: scale(1.02);
            border-color: var(--color-secondary);
        }

        /* --- Secciones y Tarjetas --- */
        .section {
            padding: var(--spacing-xxl) 0;
            border-bottom: 1px solid var(--color-border);
        }
        .section:last-of-type {
            border-bottom: none;
        }
        .section-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }
        .section-header h2 {
            margin-bottom: var(--spacing-sm);
        }
        .section-header p {
            max-width: 70ch;
            margin: 0 auto;
            color: var(--color-text-secondary);
        }

        .grid-layout {
            display: grid;
            gap: var(--spacing-lg);
        }
        @media (min-width: 768px) {
            .grid-layout {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        .card {
            background-color: var(--color-glass-bg);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            transition: transform var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        /* --- Formularios --- */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: var(--spacing-sm);
            color: var(--color-text-secondary);
        }
        .form-group input, .form-group select {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: 8px;
            border: 1px solid var(--color-border);
            background-color: var(--color-surface);
            color: var(--color-text-primary);
            font-size: 1rem;
            width: 100%;
            transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.2);
        }
        .form-grid {
            display: grid;
            gap: var(--spacing-md);
        }
        @media (min-width: 500px) {
            .form-grid { grid-template-columns: 1fr 1fr; }
        }

        /* --- Resultados --- */
        .result-box {
            margin-top: var(--spacing-lg);
            padding: var(--spacing-md);
            background-color: var(--color-bg);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            min-height: 50px;
        }
        .result-box h3 {
            margin-top: 0;
            color: var(--color-primary);
            font-size: 1.25rem;
        }
        .result-value {
            font-size: var(--font-size-h3);
            font-weight: 700;
            color: var(--color-secondary);
        }

        /* --- Tablas --- */
        .responsive-table-container {
            width: 100%;
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-block: var(--spacing-lg);
        }
        th, td {
            padding: var(--spacing-md);
            text-align: left;
            border-bottom: 1px solid var(--color-border);
        }
        th {
            font-weight: 600;
            background-color: var(--color-surface);
        }
        tbody tr:hover {
            background-color: var(--color-surface);
        }

        /* --- FAQ (Acordeón) --- */
        .faq-accordion details {
            background-color: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
            transition: background-color var(--transition-speed) ease;
        }
        .faq-accordion details[open] {
            background-color: var(--color-bg);
        }
        .faq-accordion summary {
            padding: var(--spacing-lg);
            font-weight: 600;
            cursor: pointer;
            list-style: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .faq-accordion summary::-webkit-details-marker {
            display: none;
        }
        .faq-accordion summary::after {
            content: '+';
            font-size: 1.5rem;
            transition: transform var(--transition-speed) ease;
        }
        .faq-accordion details[open] summary::after {
            transform: rotate(45deg);
        }
        .faq-accordion .faq-content {
            padding: 0 var(--spacing-lg) var(--spacing-lg);
            color: var(--color-text-secondary);
        }

        /* --- Footer --- */
        .main-footer {
            padding: var(--spacing-xl) 0;
            background-color: var(--color-surface);
            text-align: center;
            color: var(--color-text-secondary);
            font-size: var(--font-size-small);
        }
        .main-footer .container {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        /* SVG Charts */
        .chart-container {
            width: 100%;
            height: auto;
            min-height: 300px;
            margin-top: var(--spacing-lg);
        }
        .chart-container svg {
            width: 100%;
            height: 100%;
            display: block;
            overflow: visible;
        }
        .chart-tooltip {
            position: absolute;
            background-color: var(--color-bg);
            color: var(--color-text-primary);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            border: 1px solid var(--color-border);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            font-size: var(--font-size-small);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease, transform 0.2s ease;
            transform: translate(-50%, -100%);
            white-space: nowrap;
            z-index: 1001;
        }
    </style>
</head>
<body>

    <a href="#main-content" class="skip-link">Saltar al contenido</a>

    <header class="main-header">
        <div class="container">
            <a href="#" class="logo">
                <svg viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M21.38,10.42a1,1,0,0,0-1,0,7.1,7.1,0,0,1-7.23,7.23,1,1,0,0,0,0,2,9.1,9.1,0,0,0,9.14-9.14A1,1,0,0,0,21.38,10.42ZM12,11a1,1,0,1,0-1-1A1,1,0,0,0,12,11Zm0-5A6,6,0,1,0,6,12,6,6,0,0,0,12,6Zm0,10a4,4,0,1,1,4-4A4,4,0,0,1,12,16Z"/></svg>
                <span>Finanzas para Estudiantes</span>
            </a>
            <nav class="main-nav js-only" id="main-nav">
                <!-- Links will be populated by JS -->
            </nav>
            <div class="header-controls">
                <button class="theme-toggle js-only" id="theme-toggle" aria-label="Cambiar tema de color">
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>
                <button class="nav-toggle js-only" id="nav-toggle" aria-label="Abrir menú" aria-expanded="false" aria-controls="main-nav">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    <main id="main-content">

        <section class="hero" id="hero">
            <div class="container">
                <h1>Tu Aventura Financiera Comienza Aquí</h1>
                <p>Aprende a manejar tu dinero de forma inteligente y divertida. Desde crear tu primer presupuesto hasta entender cómo crece tu ahorro, te guiaremos paso a paso.</p>
                <a href="#presupuesto" class="btn btn-primary">Comenzar a Aprender</a>
            </div>
        </section>

        <section class="section" id="presupuesto">
            <div class="container">
                <div class="section-header">
                    <h2>Crea tu Presupuesto</h2>
                    <p>Un presupuesto es un plan para tu dinero. Te ayuda a saber cuánto ganas, cuánto gastas y a dónde va cada peso. ¡Es el primer paso para tomar el control!</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <h3>La Regla 50/30/20</h3>
                        <p>Una guía simple para empezar:</p>
                        <ul>
                            <li><strong>50% para Necesidades:</strong> Gastos fijos como transporte, comida en casa, etc.</li>
                            <li><strong>30% para Deseos:</strong> Salidas con amigos, videojuegos, ropa nueva.</li>
                            <li><strong>20% para Ahorro y Deudas:</strong> Guardar para el futuro o pagar lo que debes.</li>
                        </ul>
                        <button id="print-budget-btn" class="btn btn-secondary" style="margin-top: 1rem;">Imprimir Presupuesto</button>
                    </div>
                    <div class="card">
                        <h3>Editor de Presupuesto</h3>
                        <form id="budget-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="budget-item-name">Concepto</label>
                                    <input type="text" id="budget-item-name" placeholder="Ej: Pasajes" required>
                                </div>
                                <div class="form-group">
                                    <label for="budget-item-amount">Monto ($)</label>
                                    <input type="number" step="0.01" id="budget-item-amount" placeholder="Ej: 50" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="budget-item-category">Categoría</label>
                                <select id="budget-item-category">
                                    <option value="Necesidades">Necesidades</option>
                                    <option value="Deseos">Deseos</option>
                                    <option value="Ahorro">Ahorro</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">Agregar Partida</button>
                        </form>
                        <div class="responsive-table-container">
                            <table id="budget-table">
                                <thead><tr><th>Concepto</th><th>Monto</th><th>Categoría</th><th></th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="card">
                        <h3>Distribución de Gastos</h3>
                        <div class="chart-container" id="budget-chart-container">
                            <svg id="budget-chart" role="img" aria-labelledby="budget-chart-title"></svg>
                        </div>
                        <div id="budget-summary" class="result-box" aria-live="polite"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="interes">
            <div class="container">
                <div class="section-header">
                    <h2>Interés Simple vs. Compuesto</h2>
                    <p>El interés es el costo de pedir dinero prestado, o la ganancia por prestarlo. ¡Entender la diferencia entre simple y compuesto es clave para que tu dinero crezca!</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <h3>Calculadora de Interés</h3>
                        <form id="interest-form">
                            <div class="form-group">
                                <label for="interest-p">Capital Inicial (P)</label>
                                <input type="number" id="interest-p" value="1000">
                            </div>
                            <div class="form-group">
                                <label for="interest-r">Tasa de Interés Anual (r %)</label>
                                <input type="number" id="interest-r" value="5">
                            </div>
                            <div class="form-group">
                                <label for="interest-t">Tiempo (t años)</label>
                                <input type="number" id="interest-t" value="10">
                            </div>
                            <div class="form-group">
                                <label for="interest-n">Capitalización por año (n)</label>
                                <select id="interest-n">
                                    <option value="1">Anual</option>
                                    <option value="2">Semestral</option>
                                    <option value="4">Trimestral</option>
                                    <option value="12" selected>Mensual</option>
                                    <option value="365">Diaria</option>
                                </select>
                            </div>
                        </form>
                        <div id="interest-results" class="result-box" aria-live="polite"></div>
                    </div>
                    <div class="card" style="grid-column: 1 / -1;">
                        <h3>Comparación de Crecimiento</h3>
                        <div class="chart-container" id="interest-chart-container">
                             <svg id="interest-chart" role="img" aria-labelledby="interest-chart-title"></svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="ahorro">
            <div class="container">
                <div class="section-header">
                    <h2>Metas de Ahorro</h2>
                    <p>Ahorrar es guardar una parte de tu dinero para el futuro. Con aportes periódicos y el interés compuesto, puedes alcanzar grandes metas.</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <h3>Calculadora de Metas</h3>
                        <form id="savings-form">
                            <div class="form-group">
                                <label for="savings-goal">Meta de Ahorro (M)</label>
                                <input type="number" id="savings-goal" value="10000">
                            </div>
                            <div class="form-group">
                                <label for="savings-deposit">Aporte Mensual (d)</label>
                                <input type="number" id="savings-deposit" value="100">
                            </div>
                            <div class="form-group">
                                <label for="savings-rate">Tasa Anual (r %)</label>
                                <input type="number" id="savings-rate" value="4">
                            </div>
                             <div class="form-group">
                                <label for="savings-time">Años para Ahorrar (t)</label>
                                <input type="number" id="savings-time" value="5">
                            </div>
                        </form>
                    </div>
                    <div class="card">
                        <h3>Resultados de Ahorro</h3>
                        <p>Calcula el futuro de tus ahorros. La fórmula clave es la del valor futuro de una anualidad:</p>
                        <p>\[ FV = d \cdot \frac{(1+\frac{r}{m})^{mt}-1}{\frac{r}{m}} \]</p>
                        <div id="savings-results" class="result-box" aria-live="polite"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="deuda">
            <div class="container">
                <div class="section-header">
                    <h2>Deuda y Crédito</h2>
                    <p>El crédito te permite comprar algo ahora y pagarlo después, pero casi siempre con intereses. Entender cómo funciona te ayuda a evitar deudas costosas.</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <h3>Calculadora de Préstamo</h3>
                        <form id="loan-form">
                            <div class="form-group">
                                <label for="loan-p">Monto del Préstamo (P)</label>
                                <input type="number" id="loan-p" value="5000">
                            </div>
                            <div class="form-group">
                                <label for="loan-apr">Tasa Anual (APR %)</label>
                                <input type="number" id="loan-apr" value="15">
                            </div>
                            <div class="form-group">
                                <label for="loan-n">Plazo (años)</label>
                                <input type="number" id="loan-n" value="3">
                            </div>
                        </form>
                        <div id="loan-results" class="result-box" aria-live="polite"></div>
                    </div>
                    <div class="card" style="grid-column: 1 / -1;">
                        <h3>Tabla de Amortización</h3>
                        <p>Mira cómo cada pago se divide entre capital e interés. La fórmula de la cuota fija mensual (PMT) es:</p>
                        <p>\[ \mathrm{PMT} = P \cdot \frac{i(1+i)^n}{(1+i)^n - 1} \]</p>
                        <div class="responsive-table-container">
                            <table id="amortization-table">
                                <thead><tr><th>Mes</th><th>Pago</th><th>Interés</th><th>Capital</th><th>Saldo</th></tr></thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="inflacion">
            <div class="container">
                <div class="section-header">
                    <h2>Inflación</h2>
                    <p>La inflación hace que tu dinero pierda valor con el tiempo. Lo que hoy compras con $100, en el futuro costará más. ¡Es importante que tus ahorros crezcan más rápido que la inflación!</p>
                </div>
                <div class="grid-layout">
                    <div class="card">
                        <h3>Calculadora de Inflación</h3>
                        <p>\[ \mathrm{Valor\ Real} = \frac{\mathrm{Valor\ Nominal}}{(1+\pi)^t} \]</p>
                        <form id="inflation-form">
                            <div class="form-group">
                                <label for="inflation-amount">Monto ($)</label>
                                <input type="number" id="inflation-amount" value="1000">
                            </div>
                            <div class="form-group">
                                <label for="inflation-rate">Tasa de Inflación Anual (\(\pi\) %)</label>
                                <input type="number" id="inflation-rate" value="3">
                            </div>
                            <div class="form-group">
                                <label for="inflation-years">Años (t)</label>
                                <input type="number" id="inflation-years" value="10">
                            </div>
                        </form>
                    </div>
                    <div class="card">
                        <h3>El Poder Adquisitivo</h3>
                        <div id="inflation-results" class="result-box" aria-live="polite"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="section" id="glosario">
            <div class="container">
                <div class="section-header">
                    <h2>Glosario Financiero</h2>
                </div>
                <div class="grid-layout">
                    <div class="card"><strong>Presupuesto:</strong> Un plan detallado de ingresos y gastos durante un período de tiempo.</div>
                    <div class="card"><strong>APR (Tasa Anual Equivalente):</strong> El costo total de un préstamo en un año, incluyendo intereses y comisiones, expresado como porcentaje.</div>
                    <div class="card"><strong>Principal:</strong> La cantidad inicial de dinero de un préstamo o una inversión.</div>
                    <div class="card"><strong>Interés:</strong> El costo de usar el dinero de otra persona o la ganancia por prestar tu dinero.</div>
                    <div class="card"><strong>Amortización:</strong> El proceso de pagar una deuda a lo largo del tiempo en pagos periódicos.</div>
                    <div class="card"><strong>Inflación:</strong> El aumento general de los precios y la caída del poder adquisitivo del dinero.</div>
                    <div class="card"><strong>Anualidad:</strong> Una serie de pagos iguales realizados a intervalos regulares.</div>
                    <div class="card"><strong>Capitalización:</strong> El proceso donde los intereses generados se añaden al capital principal, generando a su vez nuevos intereses.</div>
                </div>
            </div>
        </section>

        <section class="section" id="faq">
            <div class="container">
                <div class="section-header">
                    <h2>Preguntas Frecuentes (FAQ)</h2>
                </div>
                <div class="faq-accordion">
                    <details>
                        <summary>¿Por qué es importante pagar más que el mínimo en la tarjeta de crédito?</summary>
                        <div class="faq-content">
                            <p>Pagar solo el mínimo alarga enormemente el tiempo que tardas en saldar la deuda. La mayor parte de ese pago se va a intereses, por lo que el capital (la deuda real) disminuye muy lentamente. Pagar más reduce el capital más rápido, lo que te ahorra mucho dinero en intereses a largo plazo.</p>
                        </div>
                    </details>
                    <details>
                        <summary>¿Qué diferencia hay entre capitalizar mensual vs. anual?</summary>
                        <div class="faq-content">
                            <p>La capitalización es cuando los intereses se suman a tu dinero. Si capitaliza anualmente, ganas intereses una vez al año. Si capitaliza mensualmente, ganas intereses cada mes sobre un saldo ligeramente mayor (tu dinero más los intereses del mes anterior). Por eso, una capitalización más frecuente (mensual) hace que tu dinero crezca un poco más rápido que una anual, incluso con la misma tasa de interés nominal.</p>
                        </div>
                    </details>
                    <details>
                        <summary>¿Cómo me afecta la inflación si no tengo mucho dinero?</summary>
                        <div class="faq-content">
                            <p>La inflación te afecta porque las cosas que compras regularmente (comida, transporte, etc.) se vuelven más caras. Tu dinero, aunque sea poco, compra menos cosas que antes. Por eso es importante que tus ahorros o inversiones crezcan a una tasa mayor que la inflación para que no pierdan su "poder de compra".</p>
                        </div>
                    </details>
                </div>
            </div>
        </section>
        
    </main>

    <footer class="main-footer">
        <div class="container">
            <div class="footer-links">
                <a href="#hero">Volver Arriba</a>
                <a href="#faq">FAQ</a>
            </div>
            <p>Creado con fines educativos. Esta página no constituye asesoría financiera profesional.</p>
            <p>&copy; 2024 Finanzas para Estudiantes. Todos los derechos reservados.</p>
        </div>
    </footer>

    <div id="chart-tooltip" class="chart-tooltip" role="tooltip"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        document.documentElement.classList.remove('no-js');

        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);
        
        const state = {
            theme: localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'),
            budget: JSON.parse(localStorage.getItem('budget')) || [],
        };

        const sections = $$('main > .section');
        const navLinks = {};

        function saveState() {
            localStorage.setItem('theme', state.theme);
            localStorage.setItem('budget', JSON.stringify(state.budget));
        }

        function normalizeNumber(str) {
            if (typeof str !== 'string') str = String(str);
            const cleanedStr = str.replace(/[^0-9.,-]/g, '').replace(',', '.');
            return parseFloat(cleanedStr) || 0;
        }

        function formatMoney(num, currency = 'MXN') {
            const value = normalizeNumber(num);
            if (Math.abs(value) < 0.005) return '$0.00';
            return value.toLocaleString('es-MX', {
                style: 'currency',
                currency: currency,
                minimumFractionDigits: 2,
                maximumFractionDigits: 2,
            });
        }
        
        function announce(message) {
            let announcer = $('#aria-announcer');
            if(!announcer) {
                announcer = document.createElement('div');
                announcer.id = 'aria-announcer';
                announcer.className = 'sr-only';
                announcer.setAttribute('aria-live', 'polite');
                document.body.appendChild(announcer);
            }
            announcer.textContent = message;
        }

        function refreshMathJax() {
            if (window.MathJax && window.MathJax.typeset) {
                window.MathJax.typeset();
            }
        }

        function initTheme() {
            const themeToggle = $('#theme-toggle');
            
            function applyTheme(theme) {
                document.documentElement.className = theme === 'dark' ? 'dark-mode' : 'light-mode';
                state.theme = theme;
                if(window.renderInterestChart) setTimeout(renderInterestChart, 50);
                if(window.renderBudgetPieChart) setTimeout(renderBudgetPieChart, 50);
            }

            themeToggle.addEventListener('click', () => {
                const newTheme = state.theme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            applyTheme(state.theme);
        }

        function initNavigation() {
            const navContainer = $('#main-nav');
            let navHTML = '<ul>';
            sections.forEach(section => {
                const id = section.id;
                const name = section.querySelector('h2')?.textContent;
                if (id && name) {
                   navHTML += `<li><a href="#${id}">${name}</a></li>`;
                }
            });
            navHTML += '</ul>';
            navContainer.innerHTML = navHTML;
            
            $$('#main-nav a').forEach(a => {
                const href = a.getAttribute('href');
                if (href.startsWith('#')) {
                    navLinks[href.substring(1)] = a;
                }
            });
        }

        function initScrollSpy() {
            const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        Object.values(navLinks).forEach(link => link.classList.remove('active'));
                        if (navLinks[id]) {
                            navLinks[id].classList.add('active');
                        }
                    }
                });
            }, { rootMargin: '-20% 0px -80% 0px', threshold: 0 });

            sections.forEach(section => observer.observe(section));
        }
        
        function initMobileNav() {
            const navToggle = $('#nav-toggle');
            const mainNav = $('#main-nav');
            if (navToggle && mainNav) {
                navToggle.addEventListener('click', () => {
                    const isOpen = document.body.classList.toggle('nav-open');
                    navToggle.setAttribute('aria-expanded', isOpen);
                });
                mainNav.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A') {
                        document.body.classList.remove('nav-open');
                        navToggle.setAttribute('aria-expanded', 'false');
                    }
                });
            }
        }

        function initBudget() {
            const form = $('#budget-form');
            const tableBody = $('#budget-table tbody');
            const summaryEl = $('#budget-summary');
            const chartEl = $('#budget-chart');
            const printBtn = $('#print-budget-btn');
            
            if(!form) return;

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = $('#budget-item-name').value;
                const amount = normalizeNumber($('#budget-item-amount').value);
                const category = $('#budget-item-category').value;
                
                if (name && amount > 0) {
                    state.budget.push({ id: Date.now(), name, amount, category });
                    form.reset();
                    $('#budget-item-name').focus();
                    updateBudget();
                    announce(`Partida "${name}" agregada.`);
                }
            });

            tableBody.addEventListener('click', (e) => {
                const deleteBtn = e.target.closest('button');
                if (deleteBtn && deleteBtn.classList.contains('btn-secondary')) {
                    const id = parseInt(deleteBtn.dataset.id, 10);
                    const itemIndex = state.budget.findIndex(item => item.id === id);
                    if (itemIndex > -1) {
                        const itemName = state.budget[itemIndex].name;
                        state.budget.splice(itemIndex, 1);
                        updateBudget();
                        announce(`Partida "${itemName}" eliminada.`);
                    }
                }
            });
            
            printBtn.addEventListener('click', () => window.print());

            function updateBudget() {
                saveState();
                renderBudgetTable();
                renderBudgetSummary();
                renderBudgetPieChart();
            }

            function renderBudgetTable() {
                tableBody.innerHTML = state.budget.map(item => `
                    <tr>
                        <td>${item.name}</td>
                        <td>${formatMoney(item.amount)}</td>
                        <td>${item.category}</td>
                        <td><button class="btn btn-secondary" data-id="${item.id}" aria-label="Eliminar ${item.name}" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">X</button></td>
                    </tr>
                `).join('');
            }

            function renderBudgetSummary() {
                const totals = state.budget.reduce((acc, item) => {
                    acc.total += item.amount;
                    acc[item.category] = (acc[item.category] || 0) + item.amount;
                    return acc;
                }, { total: 0 });

                if (totals.total === 0) {
                    summaryEl.innerHTML = '<p>Agrega partidas para ver tu resumen.</p>';
                    return;
                }

                const needsPct = ((totals.Necesidades || 0) / totals.total * 100).toFixed(1);
                const wantsPct = ((totals.Deseos || 0) / totals.total * 100).toFixed(1);
                const savingsPct = ((totals.Ahorro || 0) / totals.total * 100).toFixed(1);

                summaryEl.innerHTML = `
                    <h3>Resumen 50/30/20</h3>
                    <p><strong>Total:</strong> ${formatMoney(totals.total)}</p>
                    <p><strong>Necesidades:</strong> ${formatMoney(totals.Necesidades || 0)} (${needsPct}%)</p>
                    <p><strong>Deseos:</strong> ${formatMoney(totals.Deseos || 0)} (${wantsPct}%)</p>
                    <p><strong>Ahorro:</strong> ${formatMoney(totals.Ahorro || 0)} (${savingsPct}%)</p>
                `;
            }

            window.renderBudgetPieChart = function() {
                const data = state.budget.reduce((acc, item) => {
                    if (!acc[item.category]) {
                        acc[item.category] = { value: 0, name: item.category };
                    }
                    acc[item.category].value += item.amount;
                    return acc;
                }, {});
                
                const chartData = Object.values(data);
                const total = chartData.reduce((sum, d) => sum + d.value, 0);

                chartEl.innerHTML = '';
                if (total === 0) return;
                
                const style = getComputedStyle(document.body);
                const colors = {
                    'Necesidades': style.getPropertyValue('--color-primary'),
                    'Deseos': style.getPropertyValue('--color-accent'),
                    'Ahorro': style.getPropertyValue('--color-secondary')
                };

                const radius = 80;
                const cx = 150;
                const cy = 100;
                let startAngle = -90;

                chartData.forEach(slice => {
                    const angle = (slice.value / total) * 360;
                    const endAngle = startAngle + angle;

                    const x1 = cx + radius * Math.cos(Math.PI * startAngle / 180);
                    const y1 = cy + radius * Math.sin(Math.PI * startAngle / 180);
                    const x2 = cx + radius * Math.cos(Math.PI * endAngle / 180);
                    const y2 = cy + radius * Math.sin(Math.PI * endAngle / 180);

                    const largeArcFlag = angle > 180 ? 1 : 0;

                    const pathData = `M ${cx},${cy} L ${x1},${y1} A ${radius},${radius} 0 ${largeArcFlag},1 ${x2},${y2} Z`;
                    
                    const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    path.setAttribute('d', pathData);
                    path.setAttribute('fill', colors[slice.name] || '#ccc');
                    path.dataset.tooltip = `${slice.name}: ${formatMoney(slice.value)}`;
                    chartEl.appendChild(path);

                    startAngle = endAngle;
                });
                
                chartEl.setAttribute('viewBox', '0 0 300 200');
                setupTooltips(chartEl);
            }
            
            updateBudget();
        }
        
        function initInterest() {
            const form = $('#interest-form');
            if(!form) return;
            const resultsEl = $('#interest-results');
            const p = $('#interest-p'), r = $('#interest-r'), t = $('#interest-t'), n = $('#interest-n');

            function calculateAndRender() {
                const P = normalizeNumber(p.value);
                const rate = normalizeNumber(r.value) / 100;
                const time = normalizeNumber(t.value);
                const freq = normalizeNumber(n.value);

                const simpleI = P * rate * time;
                const simpleA = P + simpleI;
                const compoundA = P * Math.pow(1 + rate / freq, freq * time);
                const compoundI = compoundA - P;

                resultsEl.innerHTML = `
                    <h3>Resultados</h3>
                    <p><strong>Interés Simple:</strong> ${formatMoney(simpleI)} (Total: ${formatMoney(simpleA)})</p>
                    <p><strong>Interés Compuesto:</strong> ${formatMoney(compoundI)} (Total: ${formatMoney(compoundA)})</p>
                    <p style="color: var(--color-success)"><strong>Diferencia:</strong> ${formatMoney(compoundA - simpleA)}</p>
                `;
                
                renderInterestChart();
            }

            window.renderInterestChart = function() {
                const P = normalizeNumber(p.value);
                const rate = normalizeNumber(r.value) / 100;
                const time = normalizeNumber(t.value);
                const freq = normalizeNumber(n.value);
                
                const simpleData = [];
                const compoundData = [];

                for (let i = 0; i <= time; i++) {
                    simpleData.push({ x: i, y: P + (P * rate * i) });
                    compoundData.push({ x: i, y: P * Math.pow(1 + rate / freq, freq * i) });
                }
                
                const style = getComputedStyle(document.body);
                const series = [
                    { data: simpleData, color: style.getPropertyValue('--color-accent'), name: 'Simple' },
                    { data: compoundData, color: style.getPropertyValue('--color-primary'), name: 'Compuesto' }
                ];
                
                renderLineChart($('#interest-chart'), series, 'Año', 'Monto ($)');
            }

            form.addEventListener('input', calculateAndRender);
            calculateAndRender();
        }

        function initSavings() {
            const form = $('#savings-form');
            if(!form) return;
            const resultsEl = $('#savings-results');
            const goal = $('#savings-goal'), deposit = $('#savings-deposit'), rate = $('#savings-rate'), time = $('#savings-time');
            
            function calculateAndRender() {
                const M = normalizeNumber(goal.value);
                const d = normalizeNumber(deposit.value);
                const r = normalizeNumber(rate.value) / 100;
                const t = normalizeNumber(time.value);
                const m = 12;

                if (r > 0) {
                    const ratePerPeriod = r / m;
                    const numPeriods = m * t;
                    const fv = d * ( (Math.pow(1 + ratePerPeriod, numPeriods) - 1) / ratePerPeriod );
                    
                    resultsEl.innerHTML = `
                        <h3>Proyección de Ahorro</h3>
                        <p>En <strong>${t} años</strong>, con aportes de <strong>${formatMoney(d)}/mes</strong>, tendrás:</p>
                        <p class="result-value">${formatMoney(fv)}</p>
                        <p>Para tu meta de ${formatMoney(M)}, te ${fv >= M ? 'sobrarán ' + formatMoney(fv - M) : 'faltarán ' + formatMoney(M - fv)}.</p>
                    `;
                } else {
                    const fv = d * t * 12;
                     resultsEl.innerHTML = `
                        <h3>Proyección de Ahorro</h3>
                        <p>En <strong>${t} años</strong>, con aportes de <strong>${formatMoney(d)}/mes</strong> (sin interés), tendrás:</p>
                        <p class="result-value">${formatMoney(fv)}</p>
                        <p>Para tu meta de ${formatMoney(M)}, te ${fv >= M ? 'sobrarán ' + formatMoney(fv - M) : 'faltarán ' + formatMoney(M - fv)}.</p>
                    `;
                }
            }

            form.addEventListener('input', calculateAndRender);
            calculateAndRender();
        }

        function initLoan() {
            const form = $('#loan-form');
            if(!form) return;
            const resultsEl = $('#loan-results');
            const tableBody = $('#amortization-table tbody');
            const p = $('#loan-p'), apr = $('#loan-apr'), n = $('#loan-n');

            function calculateAndRender() {
                const P = normalizeNumber(p.value);
                const annualRate = normalizeNumber(apr.value) / 100;
                const years = normalizeNumber(n.value);

                if (P <= 0 || annualRate < 0 || years <= 0) {
                    resultsEl.innerHTML = '<h3>Resumen del Préstamo</h3><p>Ingresa valores válidos.</p>';
                    tableBody.innerHTML = '';
                    return;
                }

                const i = annualRate / 12;
                const numPayments = years * 12;
                let pmt;

                if (i > 0) {
                    pmt = P * (i * Math.pow(1 + i, numPayments)) / (Math.pow(1 + i, numPayments) - 1);
                } else {
                    pmt = P / numPayments;
                }
                
                const totalPaid = pmt * numPayments;
                const totalInterest = totalPaid - P;

                resultsEl.innerHTML = `
                    <h3>Resumen del Préstamo</h3>
                    <p><strong>Pago Mensual:</strong> ${formatMoney(pmt)}</p>
                    <p><strong>Total Pagado:</strong> ${formatMoney(totalPaid)}</p>
                    <p style="color: var(--color-alert)"><strong>Total Intereses:</strong> ${formatMoney(totalInterest)}</p>
                `;

                let balance = P;
                let scheduleHTML = '';
                for (let k = 1; k <= numPayments; k++) {
                    const interestPayment = balance * i;
                    const principalPayment = pmt - interestPayment;
                    balance -= principalPayment;
                    if (k > 500) break;
                    scheduleHTML += `
                        <tr>
                            <td>${k}</td>
                            <td>${formatMoney(pmt)}</td>
                            <td>${formatMoney(interestPayment)}</td>
                            <td>${formatMoney(principalPayment)}</td>
                            <td>${formatMoney(Math.max(0, balance))}</td>
                        </tr>
                    `;
                }
                tableBody.innerHTML = scheduleHTML;
            }

            form.addEventListener('input', calculateAndRender);
            calculateAndRender();
        }

        function initInflation() {
            const form = $('#inflation-form');
            if(!form) return;
            const resultsEl = $('#inflation-results');
            const amount = $('#inflation-amount'), rate = $('#inflation-rate'), years = $('#inflation-years');

            function calculateAndRender() {
                const nominalValue = normalizeNumber(amount.value);
                const pi = normalizeNumber(rate.value) / 100;
                const t = normalizeNumber(years.value);
                const realValue = nominalValue / Math.pow(1 + pi, t);

                resultsEl.innerHTML = `
                    <p>En <strong>${t} años</strong>, con una inflación del <strong>${rate.value}%</strong> anual...</p>
                    <p><strong>${formatMoney(nominalValue)}</strong> de hoy equivaldrán a:</p>
                    <p class="result-value">${formatMoney(realValue)}</p>
                    <p>en poder adquisitivo de hoy.</p>
                `;
            }

            form.addEventListener('input', calculateAndRender);
            calculateAndRender();
        }
        
        function initFaq() {
            const accordion = $('.faq-accordion');
            if(!accordion) return;
            accordion.addEventListener('click', (e) => {
                const summary = e.target.closest('summary');
                if (summary) {
                    const detail = summary.parentElement;
                    if (detail.hasAttribute('open')) {
                        e.preventDefault();
                        detail.removeAttribute('open');
                    }
                }
            });
        }
        
        function renderLineChart(svgEl, series, xLabel, yLabel) {
            svgEl.innerHTML = '';
            const padding = { top: 20, right: 20, bottom: 40, left: 60 };
            const width = svgEl.parentElement.clientWidth;
            const height = 300;
            
            const allData = series.flatMap(s => s.data);
            if (allData.length === 0) return;

            const xMax = Math.max(...allData.map(d => d.x));
            const yMax = Math.max(...allData.map(d => d.y));

            const xScale = (x) => padding.left + (x / (xMax || 1)) * (width - padding.left - padding.right);
            const yScale = (y) => height - padding.bottom - (y / (yMax || 1)) * (height - padding.top - padding.bottom);

            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            for (let i = 0; i <= 5; i++) {
                const y = yMax * (i / 5);
                const yPos = yScale(y);
                g.innerHTML += `<line class="grid-line" x1="${padding.left}" y1="${yPos}" x2="${width - padding.right}" y2="${yPos}" style="stroke: var(--color-border); stroke-width: 1;"/>`;
                g.innerHTML += `<text class="axis-text" x="${padding.left - 10}" y="${yPos + 4}" text-anchor="end" style="font-size: 10px; fill: var(--color-text-secondary);">${formatMoney(y).replace('MXN', '')}</text>`;
            }
            const xTickCount = Math.min(xMax, 10);
            for (let i = 0; i <= xTickCount; i++) {
                const x = Math.round(xMax * (i / xTickCount));
                const xPos = xScale(x);
                g.innerHTML += `<text class="axis-text" x="${xPos}" y="${height - padding.bottom + 15}" text-anchor="middle" style="font-size: 10px; fill: var(--color-text-secondary);">${x}</text>`;
            }
            g.innerHTML += `<line class="axis-line" x1="${padding.left}" y1="${height - padding.bottom}" x2="${width - padding.right}" y2="${height - padding.bottom}" style="stroke: var(--color-border); stroke-width: 1;"/>`;
            svgEl.appendChild(g);

            series.forEach(s => {
                const pathData = s.data.map((p, i) => `${i === 0 ? 'M' : 'L'} ${xScale(p.x)} ${yScale(p.y)}`).join(' ');
                const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                path.setAttribute('d', pathData);
                path.setAttribute('class', 'line');
                path.style.stroke = s.color;
                path.style.strokeWidth = '3';
                path.style.fill = 'none';
                svgEl.appendChild(path);

                s.data.forEach(p => {
                    const dot = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    dot.setAttribute('cx', xScale(p.x));
                    dot.setAttribute('cy', yScale(p.y));
                    dot.setAttribute('r', '5');
                    dot.style.fill = s.color;
                    dot.style.stroke = 'var(--color-surface)';
                    dot.style.strokeWidth = '2';
                    dot.dataset.tooltip = `${s.name} - Año ${p.x}: ${formatMoney(p.y)}`;
                    svgEl.appendChild(dot);
                });
            });
            
            svgEl.setAttribute('viewBox', `0 0 ${width} ${height}`);
            setupTooltips(svgEl);
        }

        function setupTooltips(svgContainer) {
            const tooltip = $('#chart-tooltip');
            const elementsWithTooltip = svgContainer.querySelectorAll('[data-tooltip]');

            elementsWithTooltip.forEach(el => {
                el.addEventListener('mousemove', (e) => {
                    tooltip.innerHTML = el.dataset.tooltip;
                    tooltip.style.opacity = '1';
                    tooltip.style.left = `${e.pageX + 10}px`;
                    tooltip.style.top = `${e.pageY - 10}px`;
                });
                el.addEventListener('mouseleave', () => {
                    tooltip.style.opacity = '0';
                });
            });
        }

        function init() {
            initTheme();
            initNavigation();
            initScrollSpy();
            initMobileNav();
            initBudget();
            initInterest();
            initSavings();
            initLoan();
            initInflation();
            initFaq();
            refreshMathJax();
        }

        init();
    });
    </script>
</body>
</html>
